{
    "docs": [
        {
            "location": "/", 
            "text": "\ud83d\udc2e + \ud83d\udc0b = \ud83d\udc95\n\n\nHelp mailcow\n\n\nLet us know about your ideas in #mailcow @ Freenode.\n\n\nServercow\n - hosted mailcow, KVM based virtual servers, webhosting and more.\n\n\n\n\nGet support\n\n\nCommercial support\n\n\nFor commercial support contact \n.\n\n\nCommunity support\n\n\n\n\nIRC @ \nFreenode, #mailcow\n\n\nForum @ \nforum.mailcow.email\n\n\nGitHub @ \nmailcow/mailcow-dockerized\n\n\n\n\nScreenshots\n\n\nYou can find screenshots \non Imgur\n.\n\n\nOverview\n\n\nThe integrated \nmailcow UI\n allows administrative work on your mail server instance as well as separated domain administrator and mailbox user access:\n\n\n\n\nDKIM key management\n\n\nBlack- and whitelists per domain and per user\n\n\nSpam score managment per-user (reject spam, mark spam, greylist)\n\n\nAllow mailbox users to create temporary spam aliases\n\n\nPrepend mail tags to subject or move mail to subfolder (per-user)\n\n\nAllow mailbox users to toggle incoming and outgoing TLS enforcement\n\n\nAllow users to reset SOGo ActiveSync device caches\n\n\nimapsync to migrate or pull remote mailboxes regularly\n\n\nTFA: Yubi OTP and U2F USB (Google Chrome and derivates only), TOTP\n\n\nAdd domains, mailboxes, aliases, domain aliases and SOGo resources\n\n\nAdd whitelisted hosts to forward mail to mailcow\n\n\n\n\nmailcow dockerized comes with \n12 containers\n linked in \none bridged network\n.\nEach container represents a single application.\n\n\n\n\nDovecot\n\n\nClamAV\n\n\nMemcached\n\n\nRedis\n\n\nMySQL\n\n\nBind9 (Resolver) (formerly PDNS Recursor)\n\n\nPHP-FPM\n\n\nPostfix\n\n\nNginx\n\n\nRmilter\n\n\nRspamd\n\n\nSOGo\n\n\n\n\n7 volumes\n to keep dynamic data - take care of them!\n\n\n\n\nvmail-vol-1\n\n\ndkim-vol-1\n\n\nredis-vol-1\n\n\nmysql-vol-1\n\n\nrspamd-vol-1\n\n\npostfix-vol-1\n\n\ncrypt-vol-1", 
            "title": "Information & Support"
        }, 
        {
            "location": "/#_1", 
            "text": "", 
            "title": "\ud83d\udc2e + \ud83d\udc0b = \ud83d\udc95"
        }, 
        {
            "location": "/#help-mailcow", 
            "text": "Let us know about your ideas in #mailcow @ Freenode.  Servercow  - hosted mailcow, KVM based virtual servers, webhosting and more.", 
            "title": "Help mailcow"
        }, 
        {
            "location": "/#get-support", 
            "text": "", 
            "title": "Get support"
        }, 
        {
            "location": "/#commercial-support", 
            "text": "For commercial support contact  .", 
            "title": "Commercial support"
        }, 
        {
            "location": "/#community-support", 
            "text": "IRC @  Freenode, #mailcow  Forum @  forum.mailcow.email  GitHub @  mailcow/mailcow-dockerized", 
            "title": "Community support"
        }, 
        {
            "location": "/#screenshots", 
            "text": "You can find screenshots  on Imgur .", 
            "title": "Screenshots"
        }, 
        {
            "location": "/#overview", 
            "text": "The integrated  mailcow UI  allows administrative work on your mail server instance as well as separated domain administrator and mailbox user access:   DKIM key management  Black- and whitelists per domain and per user  Spam score managment per-user (reject spam, mark spam, greylist)  Allow mailbox users to create temporary spam aliases  Prepend mail tags to subject or move mail to subfolder (per-user)  Allow mailbox users to toggle incoming and outgoing TLS enforcement  Allow users to reset SOGo ActiveSync device caches  imapsync to migrate or pull remote mailboxes regularly  TFA: Yubi OTP and U2F USB (Google Chrome and derivates only), TOTP  Add domains, mailboxes, aliases, domain aliases and SOGo resources  Add whitelisted hosts to forward mail to mailcow   mailcow dockerized comes with  12 containers  linked in  one bridged network .\nEach container represents a single application.   Dovecot  ClamAV  Memcached  Redis  MySQL  Bind9 (Resolver) (formerly PDNS Recursor)  PHP-FPM  Postfix  Nginx  Rmilter  Rspamd  SOGo   7 volumes  to keep dynamic data - take care of them!   vmail-vol-1  dkim-vol-1  redis-vol-1  mysql-vol-1  rspamd-vol-1  postfix-vol-1  crypt-vol-1", 
            "title": "Overview"
        }, 
        {
            "location": "/requirements/", 
            "text": "Before you run \nmailcow: dockerized\n, there are a few requirements that you should check:\n\n\n\n\nWarning\n\n\nWhen you want to run the dockerized version on your Debian 8 (Jessie) box you should \nswitch to the kernel 4.9 from jessie backports\n because there is a bug (kernel panic) with the kernel 3.16 when running docker containers with \nhealthchecks\n! For more details read: \ngithub.com/docker/docker/issues/30402\n and \nforum.mailcow.email/t/solved-mailcow-docker-causes-kernel-panic-edit/448\n\n\n\n\n\n\nInfo\n\n\n\n\nMailcow: dockerized requires \nsome ports\n to be open for incomming connections, so make sure that your firewall is not bloking these. Also make sure that no other application is interferring with mailcow's configuration.\n\n\nA correct DNS setup is crucial to every good mailserver setup, so please make sure you got at least the \nbasics\n covered bevore you begin!\n\n\nMake sure that your system has a correct date and \ntime setup\n. This is crucial for stuff like two factor TOTP authentication.\n\n\n\n\n\n\nMinimum System Resources\n\n\nPlease make sure that your system has at least the following resources:\n\n\n\n\n\n\n\n\nResource\n\n\nmailcow: dockerized\n\n\n\n\n\n\n\n\n\n\nCPU\n\n\n1 GHz\n\n\n\n\n\n\nRAM\n\n\n1 GiB\n\n\n\n\n\n\nDisk\n\n\n5 GiB\n\n\n\n\n\n\nSystem Type\n\n\nx86_64\n\n\n\n\n\n\n\n\nFirewall \n Ports\n\n\nPlease check if any of mailcow's standard ports are open and not blocked by other applications:\n\n\n# netstat -tulpn | grep -E -w \n25|80|110|143|443|465|587|993|995\n\n\n\n\n\n\nIf this command returns any results please remove or stop the application running on that port. You may also adjust mailcows ports via the \nmailcow.conf\n configuration file.\n\n\nDefault Ports\n\n\nIf you have a firewall already up and running please make sure that these ports are open for incomming connections:\n\n\n\n\n\n\n\n\nService\n\n\nProtocol\n\n\nPort\n\n\nContainer\n\n\nVariable\n\n\n\n\n\n\n\n\n\n\nPostfix SMTP\n\n\nTCP\n\n\n25\n\n\npostfix-mailcow\n\n\n${SMTP_PORT}\n\n\n\n\n\n\nPostfix SMTPS\n\n\nTCP\n\n\n465\n\n\npostfix-mailcow\n\n\n${SMTPS_PORT}\n\n\n\n\n\n\nPostfix Submission\n\n\nTCP\n\n\n587\n\n\npostfix-mailcow\n\n\n${SUBMISSION_PORT}\n\n\n\n\n\n\nDovecot IMAP\n\n\nTCP\n\n\n143\n\n\ndovecot-mailcow\n\n\n${IMAP_PORT}\n\n\n\n\n\n\nDovecot IMAPS\n\n\nTCP\n\n\n993\n\n\ndovecot-mailcow\n\n\n${IMAPS_PORT}\n\n\n\n\n\n\nDovecot POP3\n\n\nTCP\n\n\n110\n\n\ndovecot-mailcow\n\n\n${POP_PORT}\n\n\n\n\n\n\nDovecot POP3S\n\n\nTCP\n\n\n995\n\n\ndovecot-mailcow\n\n\n${POPS_PORT}\n\n\n\n\n\n\nDovecot ManageSieve\n\n\nTCP\n\n\n4190\n\n\ndovecot-mailcow\n\n\n${SIEVE_PORT}\n\n\n\n\n\n\nHTTP(S)\n\n\nTCP\n\n\n80/443\n\n\nnginx-mailcow\n\n\n${HTTP_PORT}\n / \n${HTTPS_PORT}\n\n\n\n\n\n\n\n\nDate and Time\n\n\nTo ensure that you have the correct date and time setup on your system, please check the output of \ntimedatectl status\n:\n\n\n$ timedatectl status\n      Local time: Sat \n2017\n-05-06 \n02\n:12:33 CEST\n  Universal time: Sat \n2017\n-05-06 \n00\n:12:33 UTC\n        RTC time: Sat \n2017\n-05-06 \n00\n:12:32\n       Time zone: Europe/Berlin \n(\nCEST, +0200\n)\n\n     NTP enabled: yes\nNTP synchronized: yes\n RTC in \nlocal\n TZ: no\n      DST active: yes\n Last DST change: DST began at\n                  Sun \n2017\n-03-26 \n01\n:59:59 CET\n                  Sun \n2017\n-03-26 \n03\n:00:00 CEST\n Next DST change: DST ends \n(\nthe clock jumps one hour backwards\n)\n at\n                  Sun \n2017\n-10-29 \n02\n:59:59 CEST\n                  Sun \n2017\n-10-29 \n02\n:00:00 CET\n\n\n\n\n\nThe lines \nNTP enabled: yes\n and \nNTP synchronized: yes\n indicate wether you have NTP enabled and if it's syncronized.\n\n\nTo enable NTP you need to run the command \ntimedatectl set-ntp true\n. You also need to edit your \n/etc/systemd/timesyncd.conf\n:\n\n\n# vim /etc/systemd/timesyncd.conf\n[Time]\nServers=0.pool.ntp.org 1.pool.ntp.org 2.pool.ntp.org 3.pool.ntp.org", 
            "title": "Prepare Your System"
        }, 
        {
            "location": "/requirements/#minimum-system-resources", 
            "text": "Please make sure that your system has at least the following resources:     Resource  mailcow: dockerized      CPU  1 GHz    RAM  1 GiB    Disk  5 GiB    System Type  x86_64", 
            "title": "Minimum System Resources"
        }, 
        {
            "location": "/requirements/#firewall-ports", 
            "text": "Please check if any of mailcow's standard ports are open and not blocked by other applications:  # netstat -tulpn | grep -E -w  25|80|110|143|443|465|587|993|995   If this command returns any results please remove or stop the application running on that port. You may also adjust mailcows ports via the  mailcow.conf  configuration file.", 
            "title": "Firewall &amp; Ports"
        }, 
        {
            "location": "/requirements/#default-ports", 
            "text": "If you have a firewall already up and running please make sure that these ports are open for incomming connections:     Service  Protocol  Port  Container  Variable      Postfix SMTP  TCP  25  postfix-mailcow  ${SMTP_PORT}    Postfix SMTPS  TCP  465  postfix-mailcow  ${SMTPS_PORT}    Postfix Submission  TCP  587  postfix-mailcow  ${SUBMISSION_PORT}    Dovecot IMAP  TCP  143  dovecot-mailcow  ${IMAP_PORT}    Dovecot IMAPS  TCP  993  dovecot-mailcow  ${IMAPS_PORT}    Dovecot POP3  TCP  110  dovecot-mailcow  ${POP_PORT}    Dovecot POP3S  TCP  995  dovecot-mailcow  ${POPS_PORT}    Dovecot ManageSieve  TCP  4190  dovecot-mailcow  ${SIEVE_PORT}    HTTP(S)  TCP  80/443  nginx-mailcow  ${HTTP_PORT}  /  ${HTTPS_PORT}", 
            "title": "Default Ports"
        }, 
        {
            "location": "/requirements/#date-and-time", 
            "text": "To ensure that you have the correct date and time setup on your system, please check the output of  timedatectl status :  $ timedatectl status\n      Local time: Sat  2017 -05-06  02 :12:33 CEST\n  Universal time: Sat  2017 -05-06  00 :12:33 UTC\n        RTC time: Sat  2017 -05-06  00 :12:32\n       Time zone: Europe/Berlin  ( CEST, +0200 ) \n     NTP enabled: yes\nNTP synchronized: yes\n RTC in  local  TZ: no\n      DST active: yes\n Last DST change: DST began at\n                  Sun  2017 -03-26  01 :59:59 CET\n                  Sun  2017 -03-26  03 :00:00 CEST\n Next DST change: DST ends  ( the clock jumps one hour backwards )  at\n                  Sun  2017 -10-29  02 :59:59 CEST\n                  Sun  2017 -10-29  02 :00:00 CET  The lines  NTP enabled: yes  and  NTP synchronized: yes  indicate wether you have NTP enabled and if it's syncronized.  To enable NTP you need to run the command  timedatectl set-ntp true . You also need to edit your  /etc/systemd/timesyncd.conf :  # vim /etc/systemd/timesyncd.conf\n[Time]\nServers=0.pool.ntp.org 1.pool.ntp.org 2.pool.ntp.org 3.pool.ntp.org", 
            "title": "Date and Time"
        }, 
        {
            "location": "/dns/", 
            "text": "Below you can find a list of \nrecommended DNS records\n. While some are mandatory for a mail server (A, MX), others are recommended to build a good reputation score (TXT/SPF) or used for auto-configuration of mail clients (SRV).\n\n\nReferences\n\n\n\n\nA good article covering all relevant topics:\n  \n\"3 DNS Records Every Email Marketer Must Know\"\n      \n\n\nAnother great one, but Zimbra as an example platform:\n  \n\"Best Practices on Email Protection: SPF, DKIM and DMARC\"\n       \n\n\nAn in-depth discussion of SPF, DKIM and DMARC:\n  \n\"How to eliminate spam and protect your name with DMARC\"\n\n\n\n\nReverse DNS of your IP\n\n\nMake sure that the PTR record of your IP matches the FQDN of your mailcow host: \n${MAILCOW_HOSTNAME}\n \n1\n. This record is usually set at the provider you leased the IP (server) from.\n\n\nThe minimal DNS configuration\n\n\nThis example shows you a set of records for one domain managed by mailcow. Each domain that is added to mailcow needs at least this set or records to function correctly.\n\n\n# Name              Type       Value\nmail                IN A       1.2.3.4\nautodiscover        IN A       1.2.3.4\nautoconfig          IN A       1.2.3.4\n\n@                   IN MX 10   mail\n\n\n\n\n\nDKIM, SPF and DMARC\n\n\nIn the example DNS zone file snippet below, a simple \nSPF\n TXT record is used to only allow THIS server (the MX) to send mail for your domain. Every other server is disallowed but able to (\"\n~all\n\"). Please refer to \nSPF Project\n for further reading.\n\n\n@                   IN TXT     \nv=spf1 mx ~all\n\n\n\n\n\n\nIt is highly recommended to create a \nDKIM\n TXT record in your mailcow UI and set the corresponding TXT record in your DNS records. Please refer to \nOpenDKIM\n for further reading.\n\n\ndefault._domainkey  IN TXT     \nv=DKIM1; k=rsa; t=s; s=email; p=...\n\n\n\n\n\n\nThe last step in protecting yourself and others is the implementation of a \nDMARC\n TXT record, for example by using the \nDMARC Assistant\n (\ncheck\n).\n\n\n_dmarc              IN TXT     \nv=DMARC1; p=reject; rua=mailto:mailauth-reports@example.org\n\n\n\n\n\n\nThe advanced DNS configuration\n\n\nSRV\n records specify the server(s) for a specific protocol on your domain. If you want to explicitly announce a service as not provided, give \".\" as the target address (instead of \"mail.example.tld.\"). Please refer to \nRFC 2782\n.\n\n\n_imap._tcp          IN SRV     0 1 143 mail.example.org.\n_imaps._tcp         IN SRV     0 1 993 mail.example.org.\n_pop3._tcp          IN SRV     0 1 110 mail.example.org.\n_pop3s._tcp         IN SRV     0 1 995 mail.example.org.\n_submission._tcp    IN SRV     0 1 587 mail.example.org.\n_autoconfig._tcp    IN SRV     0 1 443 autoconfig.example.org.\n_autodiscover._tcp  IN SRV     0 1 443 autodiscover.example.org.\n\n\n\n\n\nTesting\n\n\nHere are some tools you can use to verify your DNS configuration:\n\n\n\n\nMX Toolbox\n (DNS, SMTP, RBL)\n\n\nport25.com\n (DKIM, SPF)\n\n\nHAD Pilot\n (DKIM, DMARC, SPF)\n\n\nDMARC Analyzer\n (DMARC, SPF)\n\n\n\n\nMisc\n\n\nIf you are interested in statistics, you can additionally register with the \nPostmaster Tool\n  by Google and supply a \ngoogle-site-verification\n TXT record, which will give you details about spam-classified mails by your domain. This is clearly optional.\n\n\n@                   IN TXT     \ngoogle-site-verification=...\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nA \nFully Qualified Domain Name\n (\nFQDN\n) is the complete (absolute) domain name for a specific computer or host, on the Internet. The FQDN consists of at least three parts devided by a dot: the hostname (myhost), the domain name (mydomain) and the toplevel domain in short \ntld\n (com). In the example of \nmx.mailcow.email\n the hostname would be \nmx\n, the domain name 'mailcow' and the tld \nemail\n.", 
            "title": "DNS Setup"
        }, 
        {
            "location": "/dns/#references", 
            "text": "A good article covering all relevant topics:\n   \"3 DNS Records Every Email Marketer Must Know\"         Another great one, but Zimbra as an example platform:\n   \"Best Practices on Email Protection: SPF, DKIM and DMARC\"          An in-depth discussion of SPF, DKIM and DMARC:\n   \"How to eliminate spam and protect your name with DMARC\"", 
            "title": "References"
        }, 
        {
            "location": "/dns/#reverse-dns-of-your-ip", 
            "text": "Make sure that the PTR record of your IP matches the FQDN of your mailcow host:  ${MAILCOW_HOSTNAME}   1 . This record is usually set at the provider you leased the IP (server) from.", 
            "title": "Reverse DNS of your IP"
        }, 
        {
            "location": "/dns/#the-minimal-dns-configuration", 
            "text": "This example shows you a set of records for one domain managed by mailcow. Each domain that is added to mailcow needs at least this set or records to function correctly.  # Name              Type       Value\nmail                IN A       1.2.3.4\nautodiscover        IN A       1.2.3.4\nautoconfig          IN A       1.2.3.4\n\n@                   IN MX 10   mail", 
            "title": "The minimal DNS configuration"
        }, 
        {
            "location": "/dns/#dkim-spf-and-dmarc", 
            "text": "In the example DNS zone file snippet below, a simple  SPF  TXT record is used to only allow THIS server (the MX) to send mail for your domain. Every other server is disallowed but able to (\" ~all \"). Please refer to  SPF Project  for further reading.  @                   IN TXT      v=spf1 mx ~all   It is highly recommended to create a  DKIM  TXT record in your mailcow UI and set the corresponding TXT record in your DNS records. Please refer to  OpenDKIM  for further reading.  default._domainkey  IN TXT      v=DKIM1; k=rsa; t=s; s=email; p=...   The last step in protecting yourself and others is the implementation of a  DMARC  TXT record, for example by using the  DMARC Assistant  ( check ).  _dmarc              IN TXT      v=DMARC1; p=reject; rua=mailto:mailauth-reports@example.org", 
            "title": "DKIM, SPF and DMARC"
        }, 
        {
            "location": "/dns/#the-advanced-dns-configuration", 
            "text": "SRV  records specify the server(s) for a specific protocol on your domain. If you want to explicitly announce a service as not provided, give \".\" as the target address (instead of \"mail.example.tld.\"). Please refer to  RFC 2782 .  _imap._tcp          IN SRV     0 1 143 mail.example.org.\n_imaps._tcp         IN SRV     0 1 993 mail.example.org.\n_pop3._tcp          IN SRV     0 1 110 mail.example.org.\n_pop3s._tcp         IN SRV     0 1 995 mail.example.org.\n_submission._tcp    IN SRV     0 1 587 mail.example.org.\n_autoconfig._tcp    IN SRV     0 1 443 autoconfig.example.org.\n_autodiscover._tcp  IN SRV     0 1 443 autodiscover.example.org.", 
            "title": "The advanced DNS configuration"
        }, 
        {
            "location": "/dns/#testing", 
            "text": "Here are some tools you can use to verify your DNS configuration:   MX Toolbox  (DNS, SMTP, RBL)  port25.com  (DKIM, SPF)  HAD Pilot  (DKIM, DMARC, SPF)  DMARC Analyzer  (DMARC, SPF)", 
            "title": "Testing"
        }, 
        {
            "location": "/dns/#misc", 
            "text": "If you are interested in statistics, you can additionally register with the  Postmaster Tool   by Google and supply a  google-site-verification  TXT record, which will give you details about spam-classified mails by your domain. This is clearly optional.  @                   IN TXT      google-site-verification=...       A  Fully Qualified Domain Name  ( FQDN ) is the complete (absolute) domain name for a specific computer or host, on the Internet. The FQDN consists of at least three parts devided by a dot: the hostname (myhost), the domain name (mydomain) and the toplevel domain in short  tld  (com). In the example of  mx.mailcow.email  the hostname would be  mx , the domain name 'mailcow' and the tld  email .", 
            "title": "Misc"
        }, 
        {
            "location": "/mc14_migrate/", 
            "text": "Warning\n\n\nPlease be adviced that this guide is a first draft. Mailcow: dockerized changed quite a lot on its DB configuration. It now uses the InnoDB file format \nBarracuda\n and the \nutf8mb4\n character set. There is also some change to the DB / TABLE structure.\n\n\n\n\n\n\nInfo\n\n\nAlso note that this guide doesn't touch on the users settings like \nSpamlevels\n, \nTLS Settings\n, etc. nor the export / import of your roundcube or SOGo settings.\n\n\nLastly please check the section on how to \nimport / restore\n your maildir backup to get an idea how to migrate your mails.\n\n\n\n\nCreate mailcow db backups\n\n\nFirst you need to modify the table \nmailcow\n. Mailcow-dockerized adds three and moves two existing columns in the table \nmailbox\n. The columns \ntls_enforce_in\n and \ntls_enforce_out\n get moved two rows up (behind \ndomain\n). The columns \nkey\n, \nmultiple_bookings\n and \nwants_tagged_subject\n need to be added after \ntls_enforce_out\n.\n\n\nIt should look like this:\n\n\nMariaDB [mailcow]\n desc mailbox;\n+----------------------+--------------+------+-----+-------------------+-----------------------------+\n| Field                | Type         | Null | Key | Default           | Extra                       |\n+----------------------+--------------+------+-----+-------------------+-----------------------------+\n| username             | varchar(255) | NO   | PRI | NULL              |                             |\n| password             | varchar(255) | NO   |     | NULL              |                             |\n| name                 | varchar(255) | YES  |     | NULL              |                             |\n| maildir              | varchar(255) | NO   |     | NULL              |                             |\n| quota                | bigint(20)   | NO   |     | 0                 |                             |\n| local_part           | varchar(255) | NO   |     | NULL              |                             |\n| domain               | varchar(255) | NO   | MUL | NULL              |                             |\n| tls_enforce_in       | tinyint(1)   | NO   |     | 0                 |                             |\n| tls_enforce_out      | tinyint(1)   | NO   |     | 0                 |                             |\n| kind                 | varchar(100) | NO   |     |                   |                             |\n| multiple_bookings    | tinyint(1)   | NO   |     | 0                 |                             |\n| wants_tagged_subject | tinyint(1)   | NO   |     | 0                 |                             |\n| created              | datetime     | NO   |     | CURRENT_TIMESTAMP |                             |\n| modified             | datetime     | YES  |     | NULL              | on update CURRENT_TIMESTAMP |\n| active               | tinyint(1)   | NO   |     | 1                 |                             |\n+----------------------+--------------+------+-----+-------------------+-----------------------------+\n\n\n\n\n\nYou can do this with a UI like \nAdminer\n or use the MySQL CLI like :\n\n\nMariaDB [mailcow]\n ALTER TABLE mailbox MODIFY COLUMN tls_enforce_in TINYINT(1) NOT NULL DEFAULT \n0\n AFTER domain,\nMODIFY COLUMN tls_enforce_out TINYINT(1) NOT NULL DEFAULT \n0\n AFTER tls_enforce_in;\nMariaDB [mailcow]\n ALTER TABLE mailbox ADD COLUMN `kind` VARCHAR(255) NOT NULL AFTER `tls_enforce_out`,\nADD COLUMN `multiple_bookings` TINYINT(1) NOT NULL DEFAULT \n0\n AFTER `kind`,\nADD COLUMN `wants_tagged_subject` TINYINT(1) NOT NULL DEFAULT \n0\n AFTER `multiple_bookings`;\nMariaDB [mailcow]\n DESC mailbox;\n\n\n\n\n\nWhen this is done we can backup the tables:\n\n\n# Load your mysql variables into environment\n\n\nDBHOST\n=\n$(\ngrep database_host /var/www/mail/inc/vars.inc.php \n|\n cut -d\n -f2\n)\n\n\nDBNAME\n=\n$(\ngrep database_name /var/www/mail/inc/vars.inc.php \n|\n cut -d\n -f2\n)\n\n\nDBUSER\n=\n$(\ngrep database_user /var/www/mail/inc/vars.inc.php \n|\n cut -d\n -f2\n)\n\n\nDBPASS\n=\n$(\ngrep database_pass /var/www/mail/inc/vars.inc.php \n|\n cut -d\n -f2\n)\n\n\n\n# Backup your tables\n\nmysqldump --replace --no-create-info --default-character-set\n=\nutf8mb4 \n\\\n\n    --host \n{\nDBHOST\n}\n-u\n${\nDBUSER\n}\n -p\n${\nDBPASS\n}\n \n${\nDBNAME\n}\n \n\\\n\n    \nalias\n alias_domain domain domain_admins mailbox quota2 sender_acl \n backup_mailcow.sql\n\n\n\n\n\n\n\nInfo\n\n\n\n\n--replace\n: Write \nREPLACE\n statements rather than \nINSERT\n statements\n\n\n--no-create-info\n: Don't write \nCREATE TABLE\n statements.\n\n\n--default-character-set\n make sure our exported default charset is \nutf8mb4\n.\n\n\n\n\n\n\nPrepare mailcow: dockerized\n\n\nTo initiate your fresh installed database, visit \nhttps://${MAILCOW_HOSTNAME}\n with a browser of your choice. Check if the DB is initiated correctly afterwards:\n\n\n# source mailcow.conf\n# docker-compose exec mysql-mailcow mysql -u\n${\nDBUSER\n}\n -p\n${\nDBPASS\n}\n \n${\nDBNAME\n}\n\nMariaDB [mailcow]\n show tables;\n+-------------------------------+\n| Tables_in_mailcow             |\n+-------------------------------+\n| admin                         |\n| alias                         |\n[...]\n\n\n\n\n\nImport your backups:\n\n\n# source mailcow.conf\n  # docker exec -i $(docker-compose ps -q mysql-mailcow) mysql -u${DBUSER} -p${DBPASS} ${DBNAME} \n backup_mailcow.sql\n\n\nRecalculate used quota with \ndoveadm\n:\n\n\n# docker-compose exec dovecot-mailcow doveadm quota recalc -A\n\n\nRestart services:\n\n\n# docker-compose restart", 
            "title": "Migrating from mailcow 0.14"
        }, 
        {
            "location": "/mc14_migrate/#create-mailcow-db-backups", 
            "text": "First you need to modify the table  mailcow . Mailcow-dockerized adds three and moves two existing columns in the table  mailbox . The columns  tls_enforce_in  and  tls_enforce_out  get moved two rows up (behind  domain ). The columns  key ,  multiple_bookings  and  wants_tagged_subject  need to be added after  tls_enforce_out .  It should look like this:  MariaDB [mailcow]  desc mailbox;\n+----------------------+--------------+------+-----+-------------------+-----------------------------+\n| Field                | Type         | Null | Key | Default           | Extra                       |\n+----------------------+--------------+------+-----+-------------------+-----------------------------+\n| username             | varchar(255) | NO   | PRI | NULL              |                             |\n| password             | varchar(255) | NO   |     | NULL              |                             |\n| name                 | varchar(255) | YES  |     | NULL              |                             |\n| maildir              | varchar(255) | NO   |     | NULL              |                             |\n| quota                | bigint(20)   | NO   |     | 0                 |                             |\n| local_part           | varchar(255) | NO   |     | NULL              |                             |\n| domain               | varchar(255) | NO   | MUL | NULL              |                             |\n| tls_enforce_in       | tinyint(1)   | NO   |     | 0                 |                             |\n| tls_enforce_out      | tinyint(1)   | NO   |     | 0                 |                             |\n| kind                 | varchar(100) | NO   |     |                   |                             |\n| multiple_bookings    | tinyint(1)   | NO   |     | 0                 |                             |\n| wants_tagged_subject | tinyint(1)   | NO   |     | 0                 |                             |\n| created              | datetime     | NO   |     | CURRENT_TIMESTAMP |                             |\n| modified             | datetime     | YES  |     | NULL              | on update CURRENT_TIMESTAMP |\n| active               | tinyint(1)   | NO   |     | 1                 |                             |\n+----------------------+--------------+------+-----+-------------------+-----------------------------+  You can do this with a UI like  Adminer  or use the MySQL CLI like :  MariaDB [mailcow]  ALTER TABLE mailbox MODIFY COLUMN tls_enforce_in TINYINT(1) NOT NULL DEFAULT  0  AFTER domain,\nMODIFY COLUMN tls_enforce_out TINYINT(1) NOT NULL DEFAULT  0  AFTER tls_enforce_in;\nMariaDB [mailcow]  ALTER TABLE mailbox ADD COLUMN `kind` VARCHAR(255) NOT NULL AFTER `tls_enforce_out`,\nADD COLUMN `multiple_bookings` TINYINT(1) NOT NULL DEFAULT  0  AFTER `kind`,\nADD COLUMN `wants_tagged_subject` TINYINT(1) NOT NULL DEFAULT  0  AFTER `multiple_bookings`;\nMariaDB [mailcow]  DESC mailbox;  When this is done we can backup the tables:  # Load your mysql variables into environment  DBHOST = $( grep database_host /var/www/mail/inc/vars.inc.php  |  cut -d  -f2 )  DBNAME = $( grep database_name /var/www/mail/inc/vars.inc.php  |  cut -d  -f2 )  DBUSER = $( grep database_user /var/www/mail/inc/vars.inc.php  |  cut -d  -f2 )  DBPASS = $( grep database_pass /var/www/mail/inc/vars.inc.php  |  cut -d  -f2 )  # Backup your tables \nmysqldump --replace --no-create-info --default-character-set = utf8mb4  \\ \n    --host  { DBHOST } -u ${ DBUSER }  -p ${ DBPASS }   ${ DBNAME }   \\ \n     alias  alias_domain domain domain_admins mailbox quota2 sender_acl   backup_mailcow.sql   Info   --replace : Write  REPLACE  statements rather than  INSERT  statements  --no-create-info : Don't write  CREATE TABLE  statements.  --default-character-set  make sure our exported default charset is  utf8mb4 .", 
            "title": "Create mailcow db backups"
        }, 
        {
            "location": "/mc14_migrate/#prepare-mailcow-dockerized", 
            "text": "To initiate your fresh installed database, visit  https://${MAILCOW_HOSTNAME}  with a browser of your choice. Check if the DB is initiated correctly afterwards:  # source mailcow.conf\n# docker-compose exec mysql-mailcow mysql -u ${ DBUSER }  -p ${ DBPASS }   ${ DBNAME } \nMariaDB [mailcow]  show tables;\n+-------------------------------+\n| Tables_in_mailcow             |\n+-------------------------------+\n| admin                         |\n| alias                         |\n[...]", 
            "title": "Prepare mailcow: dockerized"
        }, 
        {
            "location": "/mc14_migrate/#import-your-backups", 
            "text": "# source mailcow.conf\n  # docker exec -i $(docker-compose ps -q mysql-mailcow) mysql -u${DBUSER} -p${DBPASS} ${DBNAME}   backup_mailcow.sql  Recalculate used quota with  doveadm :  # docker-compose exec dovecot-mailcow doveadm quota recalc -A  Restart services:  # docker-compose restart", 
            "title": "Import your backups:"
        }, 
        {
            "location": "/install/", 
            "text": "You need Docker and Docker Compose.\n\n\n1. Learn how to install \nDocker\n and \nDocker Compose\n.\n\n\nQuick installation for most operation systems:\n\n\n\n\nDocker\n\n\n\n\ncurl -sSL https://get.docker.com/ | sh\n\n\n\n\n\n\n\nDocker-Compose\n\n\n\n\ncurl -L https://github.com/docker/compose/releases/download/$(curl -Ls https://www.servercow.de/docker-compose/latest.php)/docker-compose-$(uname -s)-$(uname -m) \n /usr/local/bin/docker-compose\nchmod +x /usr/local/bin/docker-compose\n\n\n\n\n\nPlease use the latest Docker engine available and do not use the engine that ships with your distros repository.\n\n\n2. Clone the master branch of the repository\n\n\ngit clone https://github.com/andryyy/mailcow-dockerized \n cd mailcow-dockerized\n\n\n\n\n\n3. Generate a configuration file. Use a FQDN (\nhost.domain.tld\n) as hostname when asked.\n\n\n./generate_config.sh\n\n\n\n\n\n4. Change configuration if you want or need to.\n\n\nnano mailcow.conf\n\n\n\n\n\nIf you plan to use a reverse proxy, you can, for example, bind HTTPS to 127.0.0.1 on port 8443 and HTTP to 127.0.0.1 on port 8080.\n\n\nYou may need to stop an existing pre-installed MTA which blocks port 25/tcp. See \nthis chapter\n to learn how to reconfigure Postfix to run besides mailcow after a successful installation.\n\n\n5. Pull the images and run the composer file. The paramter \n-d\n will start mailcow: dockerized detached:\n\n\ndocker-compose pull\ndocker-compose up -d\n\n\n\n\n\nDone!\n\n\nYou can now access \nhttps://${MAILCOW_HOSTNAME}\n with the default credentials \nadmin\n + password \nmoohoo\n.\n\n\nThe database will be initialized right after a connection to MySQL can be established.", 
            "title": "Installation"
        }, 
        {
            "location": "/update/", 
            "text": "There is no update routine. You need to refresh your pulled repository clone and apply your local changes (if any). Actually there are many ways to merge local changes.\n\n\nStep 1, method 1\n\n\nStash all local changes, pull changes from the remote master branch and apply your stash on top of it. You will most likely see warnings about non-commited changes; you can ignore them:\n\n\n# Stash local changes\ngit stash\n# Re-pull master\ngit pull\n# Apply stash and remove it\ngit stash pop\n\n\n\n\n\nStep 1, method 2\n\n\nFetch new data from GitHub, commit changes and merge remote repository: \n\n\n# Get updates/changes\ngit fetch\n# Add all changed files to local clone\ngit add -A\n# Commit changes, ignore git complaining about username and mail address\ngit commit -m \nLocal config aat $(date)\n\n# Merge changes\ngit merge\n\n\n\n\n\nIf git complains about conflicts, solve them! Example:\n\n\nCONFLICT (content): Merge conflict in data/web/index.php\n\n\n\n\n\nOpen \ndata/web/index.php\n, solve the conflict, close the file and run \ngit add -A\n + \ngit commit -m \"Solved conflict\"\n.\n\n\nStep 1, method 3\n\n\nThanks to fabreg @ GitHub!\n\n\nIn case both methods do not work (for many reason like you're unable to fix the CONFLICTS or any other reasons) you can simply start all over again.\n\n\nKeep in mind that all local changes \nto configuration files\n will be lost. However, your volumes will not be removed.\n\n\n\n\nCopy mailcow.conf somewhere outside the mailcow-dockerized directory\n\n\nStop and remove mailcow containers: \ndocker-compose down\n\n\nDelete the directory or rename it\n\n\nClone the remote repository again (\ngit clone https://github.com/andryyy/mailcow-dockerized \n cd mailcow-dockerized\n). \nPay attention\n to this step - the folder must have the same name of the previous one!\n\n\nCopy back your previous \nmailcow.conf\n into the mailcow-dockerizd folder \n\n\n\n\nIf you forgot to stop Docker before deleting the cloned directoy, you can use the following commands:\n\n\ndocker stop $(docker ps -a -q)\ndocker rm $(docker ps -a -q)\n\n\n\n\n\nStep 2\n\n\nPull new images (if any) and recreate changed containers:\n\n\ndocker-compose pull\ndocker-compose up -d --remove-orphans\n\n\n\n\n\nStep 3\n\n\nClean-up dangling (unused) images and volumes:\n\n\ndocker rmi -f $(docker images -f \ndangling=true\n -q)\ndocker volume rm $(docker volume ls -qf dangling=true)", 
            "title": "Update"
        }, 
        {
            "location": "/update/#step-1-method-1", 
            "text": "Stash all local changes, pull changes from the remote master branch and apply your stash on top of it. You will most likely see warnings about non-commited changes; you can ignore them:  # Stash local changes\ngit stash\n# Re-pull master\ngit pull\n# Apply stash and remove it\ngit stash pop", 
            "title": "Step 1, method 1"
        }, 
        {
            "location": "/update/#step-1-method-2", 
            "text": "Fetch new data from GitHub, commit changes and merge remote repository:   # Get updates/changes\ngit fetch\n# Add all changed files to local clone\ngit add -A\n# Commit changes, ignore git complaining about username and mail address\ngit commit -m  Local config aat $(date) \n# Merge changes\ngit merge  If git complains about conflicts, solve them! Example:  CONFLICT (content): Merge conflict in data/web/index.php  Open  data/web/index.php , solve the conflict, close the file and run  git add -A  +  git commit -m \"Solved conflict\" .", 
            "title": "Step 1, method 2"
        }, 
        {
            "location": "/update/#step-1-method-3", 
            "text": "Thanks to fabreg @ GitHub!  In case both methods do not work (for many reason like you're unable to fix the CONFLICTS or any other reasons) you can simply start all over again.  Keep in mind that all local changes  to configuration files  will be lost. However, your volumes will not be removed.   Copy mailcow.conf somewhere outside the mailcow-dockerized directory  Stop and remove mailcow containers:  docker-compose down  Delete the directory or rename it  Clone the remote repository again ( git clone https://github.com/andryyy/mailcow-dockerized   cd mailcow-dockerized ).  Pay attention  to this step - the folder must have the same name of the previous one!  Copy back your previous  mailcow.conf  into the mailcow-dockerizd folder    If you forgot to stop Docker before deleting the cloned directoy, you can use the following commands:  docker stop $(docker ps -a -q)\ndocker rm $(docker ps -a -q)", 
            "title": "Step 1, method 3"
        }, 
        {
            "location": "/update/#step-2", 
            "text": "Pull new images (if any) and recreate changed containers:  docker-compose pull\ndocker-compose up -d --remove-orphans", 
            "title": "Step 2"
        }, 
        {
            "location": "/update/#step-3", 
            "text": "Clean-up dangling (unused) images and volumes:  docker rmi -f $(docker images -f  dangling=true  -q)\ndocker volume rm $(docker volume ls -qf dangling=true)", 
            "title": "Step 3"
        }, 
        {
            "location": "/ssl/", 
            "text": "mailcow dockerized comes with a snakeoil CA \"mailcow\" and a server certificate in \ndata/assets/ssl\n. Please use your own trusted certificates.\n\n\nmailcow uses \nat least\n 3 domain names that should be covered by your new certificate:\n\n\n\n\n${MAILCOW_HOSTNAME}\n\n\nautodiscover.\nexample.org\n\n\nautoconfig.\nexample.org\n\n\n\n\nLet's Encrypt\n\n\nThis is just an example of how to obtain certificates with certbot. There are several methods!\n\n\n1. Get the certbot client:\n\n\nwget https://dl.eff.org/certbot-auto -O /usr/local/sbin/certbot \n chmod +x /usr/local/sbin/certbot\n\n\n\n\n\n2. Make sure you set \nHTTP_BIND=0.0.0.0\n and \nHTTP_PORT=80\n in \nmailcow.conf\n or setup a reverse proxy to enable connections to port 80. If you changed HTTP_BIND, then rebuild Nginx:\n\n\ndocker-compose up -d\n\n\n\n\n\n3. Request the certificate with the webroot method:\n\n\ncd\n /path/to/git/clone/mailcow-dockerized\n\nsource\n mailcow.conf\ncertbot certonly \n\\\n\n    --webroot \n\\\n\n    -w \n${\nPWD\n}\n/data/web \n\\\n\n    -d \n${\nMAILCOW_HOSTNAME\n}\n \n\\\n\n    -d autodiscover.example.org \n\\\n\n    -d autoconfig.example.org \n\\\n\n    --email you@example.org \n\\\n\n    --agree-tos\n\n\n\n\n\n\n\nWarning\n\n\nRemember to replace the example.org domain with your own domain, this command will not work if you dont.\n\n\n\n\n4. Create hard links to the full path of the new certificates. Assuming you are still in the mailcow root folder:\n\n\nmv data/assets/ssl/cert.\n{\npem,pem.backup\n}\n\nmv data/assets/ssl/key.\n{\npem,pem.backup\n}\n\nln \n$(\nreadlink -f /etc/letsencrypt/live/\n${\nMAILCOW_HOSTNAME\n}\n/fullchain.pem\n)\n data/assets/ssl/cert.pem\nln \n$(\nreadlink -f /etc/letsencrypt/live/\n${\nMAILCOW_HOSTNAME\n}\n/privkey.pem\n)\n data/assets/ssl/key.pem\n\n\n\n\n\n5. Restart affected containers:\n\n\ndocker-compose restart postfix-mailcow dovecot-mailcow nginx-mailcow\n\n\n\n\n\nWhen renewing certificates, run the last two steps (link + restart) as post-hook in a script.", 
            "title": "SSL"
        }, 
        {
            "location": "/ssl/#lets-encrypt", 
            "text": "This is just an example of how to obtain certificates with certbot. There are several methods!  1. Get the certbot client:  wget https://dl.eff.org/certbot-auto -O /usr/local/sbin/certbot   chmod +x /usr/local/sbin/certbot  2. Make sure you set  HTTP_BIND=0.0.0.0  and  HTTP_PORT=80  in  mailcow.conf  or setup a reverse proxy to enable connections to port 80. If you changed HTTP_BIND, then rebuild Nginx:  docker-compose up -d  3. Request the certificate with the webroot method:  cd  /path/to/git/clone/mailcow-dockerized source  mailcow.conf\ncertbot certonly  \\ \n    --webroot  \\ \n    -w  ${ PWD } /data/web  \\ \n    -d  ${ MAILCOW_HOSTNAME }   \\ \n    -d autodiscover.example.org  \\ \n    -d autoconfig.example.org  \\ \n    --email you@example.org  \\ \n    --agree-tos   Warning  Remember to replace the example.org domain with your own domain, this command will not work if you dont.   4. Create hard links to the full path of the new certificates. Assuming you are still in the mailcow root folder:  mv data/assets/ssl/cert. { pem,pem.backup } \nmv data/assets/ssl/key. { pem,pem.backup } \nln  $( readlink -f /etc/letsencrypt/live/ ${ MAILCOW_HOSTNAME } /fullchain.pem )  data/assets/ssl/cert.pem\nln  $( readlink -f /etc/letsencrypt/live/ ${ MAILCOW_HOSTNAME } /privkey.pem )  data/assets/ssl/key.pem  5. Restart affected containers:  docker-compose restart postfix-mailcow dovecot-mailcow nginx-mailcow  When renewing certificates, run the last two steps (link + restart) as post-hook in a script.", 
            "title": "Let's Encrypt"
        }, 
        {
            "location": "/rspamd_ui/", 
            "text": "At first you may want to setup Rspamds web interface which provides some useful features and information.\n\n\n1. Generate a Rspamd controller password hash:\n\n\ndocker-compose exec rspamd-mailcow rspamadm pw\n\n\n\n\n\n2. Replace the default hash in \ndata/conf/rspamd/override.d/worker-controller.inc\n by your newly generated:\n\n\nenable_password = \nmyhash\n;\n\n\n\n\n\nYou can use \npassword = \"myhash\";\n instead of \nenable_password\n to disable write-access in the web UI.\n\n\n3. Restart rspamd:\n\n\ndocker-compose restart rspamd-mailcow\n\n\n\n\n\nOpen https://${MAILCOW_HOSTNAME}/rspamd in a browser and login!", 
            "title": "Rspamd Web UI"
        }, 
        {
            "location": "/rp/", 
            "text": "You don't need to change the Nginx site that comes with mailcow: dockerized.\nmailcow: dockerized trusts the default gateway IP 172.22.1.1 as proxy. This is very important to control access to Rspamd's web UI.\n\n\n1. Make sure you change HTTP_BIND and HTTPS_BIND in \nmailcow.conf\n to a local address and set the ports accordingly, for example:\n\n\nHTTP_BIND\n=\n127\n.0.0.1\n\nHTTP_PORT\n=\n8080\n\n\nHTTPS_PORT\n=\n127\n.0.0.1\n\nHTTPS_PORT\n=\n8443\n\n\n\n\n\n\n IMPORTANT: Do not use port 8081 \n\n\nRecreate affected containers by running \ndocker-compose up -d\n.\n\n\n2. Configure your local webserver as reverse proxy:\n\n\nApache 2.4\n\n\nVirtualHost\n \n*:443\n\n    \nServerName\n mail.example.org\n    \nServerAlias\n autodiscover.example.org\n    \nServerAlias\n autoconfig.example.org\n\n    \n[\n...\n]\n\n    \n# You should proxy to a plain HTTP session to offload SSL processing\n\n    \nProxyPass\n / http://127.0.0.1:8080/\n    \nProxyPassReverse\n / http://127.0.0.1:8080/\n\n    \nProxyPreserveHost\n \nOn\n\n    \nProxyAddHeaders\n \nOn\n\n\n    \n# This header does not need to be set when using http\n\n    \nRequestHeader\n set X-Forwarded-Proto \nhttps\n\n\n    \nyour-ssl-configuration-\nhere\n\n    [...]\n\n    \n# If you plan to proxy to a HTTPS host:\n\n    \n#SSLProxyEngine On\n\n\n    \n# If you plan to proxy to an untrusted HTTPS host:\n\n    \n#SSLProxyVerify none\n\n    \n#SSLProxyCheckPeerCN off\n\n    \n#SSLProxyCheckPeerName off\n\n    \n#SSLProxyCheckPeerExpire off\n\n\n/VirtualHost\n\n\n\n\n\n\nNginx\n\n\nserver\n \n{\n\n    \nlisten\n \n443\n;\n\n    \nserver_name\n \nmail.example.org\n \nautodiscover.example.org\n \nautoconfig.example.org\n;\n\n\n    \n[\n...\n]\n\n    \nyour-ssl-configuration-here\n\n\n    \nlocation\n \n/\n \n{\n\n        \nproxy_pass\n \nhttp\n:\n//\n127.0.0.1\n:\n8080\n/\n;\n\n        \nproxy_set_header\n \nHost\n \n$http_host\n;\n\n        \nproxy_set_header\n \nX-Real-IP\n \n$remote_addr\n;\n\n        \nproxy_set_header\n \nX-Forwarded-For\n \n$proxy_add_x_forwarded_for\n;\n\n        \nproxy_set_header\n \nX-Forwarded-Proto\n \n$scheme\n;\n\n    \n}\n\n    \n[\n...\n]\n\n\n}\n\n\n\n\n\n\nHAProxy\n\n\nfrontend https-in\n  bind :::443 v4v6 ssl crt mailcow.pem\n  default_backend mailcow\n\nbackend mailcow\n  option forwardfor\n  http-request set-header X-Forwarded-Proto https if { ssl_fc }\n  http-request set-header X-Forwarded-Proto http if !{ ssl_fc }\n  server mailcow 127.0.0.1:8080 check", 
            "title": "Reverse Proxy"
        }, 
        {
            "location": "/rp/#apache-24", 
            "text": "VirtualHost   *:443 \n     ServerName  mail.example.org\n     ServerAlias  autodiscover.example.org\n     ServerAlias  autoconfig.example.org\n\n     [ ... ] \n     # You should proxy to a plain HTTP session to offload SSL processing \n     ProxyPass  / http://127.0.0.1:8080/\n     ProxyPassReverse  / http://127.0.0.1:8080/\n\n     ProxyPreserveHost   On \n     ProxyAddHeaders   On \n\n     # This header does not need to be set when using http \n     RequestHeader  set X-Forwarded-Proto  https \n\n     your-ssl-configuration- here \n    [...]\n\n     # If you plan to proxy to a HTTPS host: \n     #SSLProxyEngine On \n\n     # If you plan to proxy to an untrusted HTTPS host: \n     #SSLProxyVerify none \n     #SSLProxyCheckPeerCN off \n     #SSLProxyCheckPeerName off \n     #SSLProxyCheckPeerExpire off  /VirtualHost", 
            "title": "Apache 2.4"
        }, 
        {
            "location": "/rp/#nginx", 
            "text": "server   { \n     listen   443 ; \n     server_name   mail.example.org   autodiscover.example.org   autoconfig.example.org ; \n\n     [ ... ] \n     your-ssl-configuration-here \n\n     location   /   { \n         proxy_pass   http : // 127.0.0.1 : 8080 / ; \n         proxy_set_header   Host   $http_host ; \n         proxy_set_header   X-Real-IP   $remote_addr ; \n         proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for ; \n         proxy_set_header   X-Forwarded-Proto   $scheme ; \n     } \n     [ ... ]  }", 
            "title": "Nginx"
        }, 
        {
            "location": "/rp/#haproxy", 
            "text": "frontend https-in\n  bind :::443 v4v6 ssl crt mailcow.pem\n  default_backend mailcow\n\nbackend mailcow\n  option forwardfor\n  http-request set-header X-Forwarded-Proto https if { ssl_fc }\n  http-request set-header X-Forwarded-Proto http if !{ ssl_fc }\n  server mailcow 127.0.0.1:8080 check", 
            "title": "HAProxy"
        }, 
        {
            "location": "/relayhost/", 
            "text": "Insert these lines into \ndata/conf/postfix/main.cf\n. \"relayhost\" does already exist (empty), just change its value.\n\n\nrelayhost = [your-relayhost]:587\nsmtp_sasl_password_maps = hash:/opt/postfix/conf/smarthost_passwd\nsmtp_sasl_auth_enable = yes\n\n\n\n\n\nCreate the credentials file:\n\n\necho \nyour-relayhost username:password\n \n data/conf/postfix/smarthost_passwd\n\n\n\n\n\nRun:\n\n\ndocker-compose exec postfix-mailcow postmap /opt/postfix/conf/smarthost_passwd\ndocker-compose exec postfix-mailcow chown root:postfix /opt/postfix/conf/smarthost_passwd /opt/postfix/conf/smarthost_passwd.db\ndocker-compose exec postfix-mailcow chmod 660 /opt/postfix/conf/smarthost_passwd /opt/postfix/conf/smarthost_passwd.db\ndocker-compose exec postfix-mailcow postfix reload\n\n\n\n\n\nHelper script\n\n\nThere is a helper script \nmailcow-setup-relayhost.sh\n you can run to setup a relayhost.\n\n\nUsage:\n\nSetup a relayhost:\n./mailcow-setup-relayhost.sh relayhost port \n(\nusername\n)\n \n(\npassword\n)\n\nUsername and password are optional parameters.\n\nReset to defaults:\n./mailcow-setup-relayhost.sh reset", 
            "title": "Setup a relayhost"
        }, 
        {
            "location": "/relayhost/#helper-script", 
            "text": "There is a helper script  mailcow-setup-relayhost.sh  you can run to setup a relayhost.  Usage:\n\nSetup a relayhost:\n./mailcow-setup-relayhost.sh relayhost port  ( username )   ( password ) \nUsername and password are optional parameters.\n\nReset to defaults:\n./mailcow-setup-relayhost.sh reset", 
            "title": "Helper script"
        }, 
        {
            "location": "/syslog/", 
            "text": "Enable Rsyslog to receive logs on 524/tcp:\n\n\n# This setting depends on your Rsyslog version and configuration format.\n# For most Debian derivates it will work like this...\n$ModLoad imtcp\n$TCPServerAddress 127.0.0.1\n$InputTCPServerRun 524\n\n# ...while for Ubuntu 16.04 it looks like this:\nmodule(load=\nimtcp\n)\ninput(type=\nimtcp\n address=\n127.0.0.1\n port=\n524\n)\n\n# No matter your Rsyslog version, you should set this option to off\n# if you plan to use Fail2ban\n$RepeatedMsgReduction off\n\n\n\n\n\nRestart rsyslog after enabling the TCP listener.\n\n\nNow setup Docker daemon to start with the syslog driver.\nThis enables the syslog driver for all containers!\n\n\nDebian users can change the startup configuration in \n/etc/default/docker\n while CentOS users find it in \n/etc/sysconfig/docker\n:\n\n\n...\nDOCKER_OPTS=\n--log-driver=syslog --log-opt syslog-address=tcp://127.0.0.1:524\n\n...\n\n\n\n\n\n\n\nWarning\n\n\nFor some reason Ubuntu 16.04 and some, but not all, systemd based distros do not read the defaults file parameters.\n\n\n\n\nJust run \nsystemctl edit docker.service\n and add the following content to fix it.\n\n\n\n\nInfo\n\n\nIf \"systemctl edit\" is not available, just copy the content to \n/etc/systemd/system/docker.service.d/override.conf\n.\n\n\n\n\nThe first empty ExecStart parameter is not a mistake.\n\n\n[Service]\n\n\nEnvironmentFile\n=\n/etc/default/docker\n\n\nExecStart\n=\n\n\nExecStart\n=\n/usr/bin/docker daemon -H fd:// $DOCKER_OPTS\n\n\n\n\n\n\nRestart the Docker daemon and run \ndocker-compose down \n docker-compose up -d\n to recreate the containers.\n\n\nFail2ban\n\n\nThis is a subsection of \"Log to Syslog\", which is required for Fail2ban to work.\n\n\nOpen \n/etc/fail2ban/filter.d/common.conf\n and search for the prefix_line parameter, change it to \".*\":\n\n\n__prefix_line = .*\n\n\n\n\n\nCreate \n/etc/fail2ban/jail.d/dovecot.conf\n...\n\n\n[dovecot]\n\n\nenabled\n \n=\n \ntrue\n\n\nfilter\n  \n=\n \ndovecot\n\n\nlogpath\n \n=\n \n/var/log/syslog\n\n\nchain\n \n=\n \nFORWARD\n\n\n\n\n\n\nand \njail.d/postfix-sasl.conf\n:\n\n\n[postfix-sasl]\n\n\nenabled\n \n=\n \ntrue\n\n\nfilter\n  \n=\n \npostfix-sasl\n\n\nlogpath\n \n=\n \n/var/log/syslog\n\n\nchain\n \n=\n \nFORWARD\n\n\n\n\n\n\nRestart Fail2ban.", 
            "title": "Log to Syslog"
        }, 
        {
            "location": "/syslog/#fail2ban", 
            "text": "This is a subsection of \"Log to Syslog\", which is required for Fail2ban to work.  Open  /etc/fail2ban/filter.d/common.conf  and search for the prefix_line parameter, change it to \".*\":  __prefix_line = .*  Create  /etc/fail2ban/jail.d/dovecot.conf ...  [dovecot]  enabled   =   true  filter    =   dovecot  logpath   =   /var/log/syslog  chain   =   FORWARD   and  jail.d/postfix-sasl.conf :  [postfix-sasl]  enabled   =   true  filter    =   postfix-sasl  logpath   =   /var/log/syslog  chain   =   FORWARD   Restart Fail2ban.", 
            "title": "Fail2ban"
        }, 
        {
            "location": "/local_mta/", 
            "text": "The easiest option would be to disable the listener on port 25/tcp.\n\n\nPostfix\n users disable the listener by commenting the following line (starting with \nsmtp\n or \n25\n) in \n/etc/postfix/master.cf\n:\n\n\n#smtp      inet  n       -       -       -       -       smtpd\n\n\n\n\n\nRestart Postfix after applying your changes.", 
            "title": "Local MTA on Docker host"
        }, 
        {
            "location": "/sender_rcv/", 
            "text": "When a mailbox is created, a user is allowed to send mail from and receive mail for his own mailbox address.\n\n\nMailbox me@example.org is created. example.org is a primary domain. \nNote: a mailbox cannot be created in an alias domain.\n\nme@example.org is only known as me@example.org.\nme@example.org is allowed to send as me@example.org.\n\n\n\n\n\nWe can add an alias domain for example.org:\n\n\nAlias domain alias.com is added and assigned to primary domain example.org.\nme@example.org is now known as me@example.org and me@alias.com.\nme@example.org is now allowed to send as me@example.org and me@alias.com.\n\n\n\n\n\nWe can add aliases for a mailbox to receive mail for and to send from this new address.\n\n\nIt is important to know, that you are not able to receive mail for \nmy-alias@my-alias-domain.tld\n. You would need to create this particular alias.\n\n\nme@example.org is assigned the alias alias@example.org\nme@example.org is now known as alias@example.org, me@alias.com, alias@example.org\n\nme@example.org is NOT known as alias@alias.com.\n\n\n\n\n\nAdministrators and domain administrators can edit mailboxes to allow specific users to send as other mailbox users (\"delegate\" them).\n\n\nYou can choose between mailbox users or completely disable the sender check for domains.\n\n\nSOGo \"mail from\" addresses\n\n\nMailbox users can, obviously, select their own mailbox address, as well as all alias addresses and aliases that exist through alias domains.\n\n\nIf you want to select another \nexisting\n mailbox user as your \"mail from\" address, this user has to delegate you access through SOGo (see SOGo documentation). Moreover a mailcow (domain) administrator\nneeds to grant you access as described above.", 
            "title": "Sender and receiver model"
        }, 
        {
            "location": "/sender_rcv/#sogo-mail-from-addresses", 
            "text": "Mailbox users can, obviously, select their own mailbox address, as well as all alias addresses and aliases that exist through alias domains.  If you want to select another  existing  mailbox user as your \"mail from\" address, this user has to delegate you access through SOGo (see SOGo documentation). Moreover a mailcow (domain) administrator\nneeds to grant you access as described above.", 
            "title": "SOGo \"mail from\" addresses"
        }, 
        {
            "location": "/debug/", 
            "text": "When a problem occurs, then always for a reason! What you want to do in such a case is:\n\n\n\n\nRead your logs; follow them to see what the reason for your problem is.\n\n\nFollow the leads given to you in your logfiles and start investigating.\n\n\nRestarting the troubled service or the whole stack to see if the problem persists.\n\n\nRead the documentation of the troubled service and search it's bugtracker for your problem.\n\n\nSearch our \nissues\n and \nforum\n for topics related to your problem.\n\n\nCreate an issue\n over at our GitHub repository if you think your problem might be a bug or a missing feature you badly need. But please make sure, that you include \nall the logs\n and a full description to your problem.\n\n\nIf you need help with a problem on a configuration or a setup, or got a question please head over to our \nforum\n and open a thread.\n\n\nConnect to IRC (\nchat.freenode.net\n) and join our IRC channel \n#mailcow\n.", 
            "title": "Introduction"
        }, 
        {
            "location": "/debug_logs/", 
            "text": "To view the logs of all mailcow: dockerized related containers, you can use \ndocker-compose logs\n inside your mailcow-dockerized folder that contains your \nmailcow.conf\n. This is usually a bit mutch but you could trim the output with \n--tail=100\n to the last 100 lines, or add a \n-f\n to follow the live output of all your services.\n\n\nTo view the logs of a specific service you can use \ndocker-compose logs [options] $Service_Name\n\n\n\n\nInfo\n\n\nThe available options for the command \ndocker-compose logs\n are:\n\n\n\n\n--no-color\n: Produce monochrome output.\n\n\n-f\n: Follow the log output.\n\n\n-t\n: Show timestamps.\n\n\n--tail=\"all\"\n: Number of lines to show from the end of the logs for each container.", 
            "title": "Logs"
        }, 
        {
            "location": "/attach_service/", 
            "text": "Attaching a Container to your Shell\n\n\nTo attach a container to your shell you can simply run\n\n\ndocker-compose exec $Service_Name /bin/bash\n\n\n\n\n\nConnecting to Services\n\n\nIf you whant to connect to a service / application directly it is always a good idea to \nsource mailcow.conf\n to get all relevant variables in your environment.\n\n\nMySQL\n\n\nsource mailcow.conf\ndocker-compose exec mysql-mailcow mysql -u\n${\nDBUSER\n}\n -p\n${\nDBPASS\n}\n \n${\nDBNAME\n}\n\n\n\n\n\n\nRedis\n\n\ndocker-compose exec redis-mailcow redis-cli\n\n\n\n\n\nService Descriptions\n\n\nHere is a brief overview of what container / service does what:\n\n\n\n\n\n\n\n\nService Name\n\n\nService Descriptions\n\n\n\n\n\n\n\n\n\n\nbind9-mailcow\n\n\nLocal (DNSSEC) DNS Resolver\n\n\n\n\n\n\nmysql-mailcow\n\n\nStores SOGo's and most of mailcow's settings\n\n\n\n\n\n\npostfix-mailcow\n\n\nReceives and sends mails\n\n\n\n\n\n\ndovecot-mailcow\n\n\nUser logins and sieve filter\n\n\n\n\n\n\nredis-mailcow\n\n\nStorage backend for DKIM keys, Rmilter and Rspamd\n\n\n\n\n\n\nrspamd-mailcow\n\n\nMail filtering system. Used for av handling, dkim signing, spam handling\n\n\n\n\n\n\nrmilter-mailcow\n\n\nIntegrates Rspamd into postfix\n\n\n\n\n\n\nclamd-mailcow\n\n\nScans attachments for viruses\n\n\n\n\n\n\nsogo-mailcow\n\n\nWebmail client that handles Microsoft ActiveSync and Cal- / CardDav\n\n\n\n\n\n\nnginx-mailcow\n\n\nNginx remote proxy that handles all mailcow related HTTP / HTTPS requests", 
            "title": "Attach a Container"
        }, 
        {
            "location": "/attach_service/#attaching-a-container-to-your-shell", 
            "text": "To attach a container to your shell you can simply run  docker-compose exec $Service_Name /bin/bash", 
            "title": "Attaching a Container to your Shell"
        }, 
        {
            "location": "/attach_service/#connecting-to-services", 
            "text": "If you whant to connect to a service / application directly it is always a good idea to  source mailcow.conf  to get all relevant variables in your environment.", 
            "title": "Connecting to Services"
        }, 
        {
            "location": "/attach_service/#mysql", 
            "text": "source mailcow.conf\ndocker-compose exec mysql-mailcow mysql -u ${ DBUSER }  -p ${ DBPASS }   ${ DBNAME }", 
            "title": "MySQL"
        }, 
        {
            "location": "/attach_service/#redis", 
            "text": "docker-compose exec redis-mailcow redis-cli", 
            "title": "Redis"
        }, 
        {
            "location": "/attach_service/#service-descriptions", 
            "text": "Here is a brief overview of what container / service does what:     Service Name  Service Descriptions      bind9-mailcow  Local (DNSSEC) DNS Resolver    mysql-mailcow  Stores SOGo's and most of mailcow's settings    postfix-mailcow  Receives and sends mails    dovecot-mailcow  User logins and sieve filter    redis-mailcow  Storage backend for DKIM keys, Rmilter and Rspamd    rspamd-mailcow  Mail filtering system. Used for av handling, dkim signing, spam handling    rmilter-mailcow  Integrates Rspamd into postfix    clamd-mailcow  Scans attachments for viruses    sogo-mailcow  Webmail client that handles Microsoft ActiveSync and Cal- / CardDav    nginx-mailcow  Nginx remote proxy that handles all mailcow related HTTP / HTTPS requests", 
            "title": "Service Descriptions"
        }, 
        {
            "location": "/reset_pw/", 
            "text": "Mailcow Admin Account\n\n\nReset mailcow admin to \nadmin:moohoo\n:\n\n\ncd mailcow_path\nbash mailcow-reset-admin.sh\n\n\n\n\n\nRemove Two-Factor Authentication\n\n\n\n\n\n\n\n\nReset MySQL Passwords\n\n\nStop the stack by running \ndocker-compose stop\n.\n\n\nWhen the containers came to a stop, run this command:\n\n\ndocker-compose run --rm --entrypoint \n/bin/sh -c \ngosu mysql mysqld --skip-grant-tables \n sleep 10 \n mysql -hlocalhost -uroot \n exit 0\n mysql-mailcow\n\n\n\n\n\n1. Find database name\n\n\nMariaDB [(none)]\n show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mailcow_database   | \n=====\n| mysql              |\n| performance_schema |\n+--------------------+\n4 rows in set (0.00 sec)\n\n\n\n\n\n2. Reset one or more users\n\n\nBoth \"password\" and \"authentication_string\" exist. Currently \"password\" is used, but better set both.\n\n\nMariaDB [(none)]\n SELECT user FROM mysql.user;\n+--------------+\n| user         |\n+--------------+\n| mailcow_user | \n=====\n| root         |\n+--------------+\n2 rows in set (0.00 sec)\n\nMariaDB [(none)]\n FLUSH PRIVILEGES;\nMariaDB [(none)]\n UPDATE mysql.user SET authentication_string = PASSWORD(\ngotr00t\n), password = PASSWORD(\ngotr00t\n) WHERE User = \nroot\n AND Host = \n%\n;\nMariaDB [(none)]\n UPDATE mysql.user SET authentication_string = PASSWORD(\nmookuh\n), password = PASSWORD(\nmookuh\n) WHERE User = \nmailcow\n AND Host = \n%\n;\nMariaDB [(none)]\n FLUSH PRIVILEGES;", 
            "title": "Reset Passwords"
        }, 
        {
            "location": "/reset_pw/#mailcow-admin-account", 
            "text": "Reset mailcow admin to  admin:moohoo :  cd mailcow_path\nbash mailcow-reset-admin.sh", 
            "title": "Mailcow Admin Account"
        }, 
        {
            "location": "/reset_pw/#remove-two-factor-authentication", 
            "text": "", 
            "title": "Remove Two-Factor Authentication"
        }, 
        {
            "location": "/reset_pw/#reset-mysql-passwords", 
            "text": "Stop the stack by running  docker-compose stop .  When the containers came to a stop, run this command:  docker-compose run --rm --entrypoint  /bin/sh -c  gosu mysql mysqld --skip-grant-tables   sleep 10   mysql -hlocalhost -uroot   exit 0  mysql-mailcow", 
            "title": "Reset MySQL Passwords"
        }, 
        {
            "location": "/reset_pw/#146-find-database-name", 
            "text": "MariaDB [(none)]  show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mailcow_database   |  =====\n| mysql              |\n| performance_schema |\n+--------------------+\n4 rows in set (0.00 sec)", 
            "title": "1. Find database name"
        }, 
        {
            "location": "/reset_pw/#246-reset-one-or-more-users", 
            "text": "Both \"password\" and \"authentication_string\" exist. Currently \"password\" is used, but better set both.  MariaDB [(none)]  SELECT user FROM mysql.user;\n+--------------+\n| user         |\n+--------------+\n| mailcow_user |  =====\n| root         |\n+--------------+\n2 rows in set (0.00 sec)\n\nMariaDB [(none)]  FLUSH PRIVILEGES;\nMariaDB [(none)]  UPDATE mysql.user SET authentication_string = PASSWORD( gotr00t ), password = PASSWORD( gotr00t ) WHERE User =  root  AND Host =  % ;\nMariaDB [(none)]  UPDATE mysql.user SET authentication_string = PASSWORD( mookuh ), password = PASSWORD( mookuh ) WHERE User =  mailcow  AND Host =  % ;\nMariaDB [(none)]  FLUSH PRIVILEGES;", 
            "title": "2. Reset one or more users"
        }, 
        {
            "location": "/rm_volumes/", 
            "text": "You may want to remove a set of persistend data to resolve a conflict or to start over:\n\n\ndocker volume rm mailcowdockerized_\n${\nVOLUME_NAME\n}\n\n\n\n\n\n\n\n\nRemove volume \nmysql-vol-1\n to remove all MySQL data.\n\n\nRemove volume \nredis-vol-1\n to remove all Redis data.\n\n\nRemove volume \nvmail-vol-1\n to remove all contents of \n/var/vmail\n mounted to \ndovecot-mailcow\n.\n\n\nRemove volume \ndkim-vol-1\n to remove all DKIM keys.\n\n\nRemove volume \nrspamd-vol-1\n to remove all Rspamd data.\n\n\n\n\nRunning \ndocker-compose down -v\n will \ndestroy all mailcow: dockerized volumes\n and delete any related containers and networks.", 
            "title": "Remove Persistent Data"
        }, 
        {
            "location": "/mailcow_ui/", 
            "text": "Several configuration parameters of the mailcow UI can be changed by creating a file \ndata/web/inc/vars.local.inc.php\n which overrides defaults settings found in \ndata/web/inc/vars.inc.php\n.\n\n\nThe local configuration file is persistent over updates of mailcow. Try not to change values inside \ndata/web/inc/vars.inc.php\n, but use them as template for the local override.\n\n\nmailcow UI configuration parameters can be to...\n\n\n\n\n...change the default language*\n\n\n...change the default bootstrap theme\n\n\n...set a password complexity regex\n\n\n...add mailcow app buttons to the login screen\n\n\n...set a pagination trigger\n\n\n...set action after submitting forms (stay in form, return to previous page)\n\n\n\n\n* To change SOGos default language, you will need to edit \ndata/conf/sogo/sogo.conf\n and replace \"English\" by your preferred language.", 
            "title": "Configuration"
        }, 
        {
            "location": "/bl_wl/", 
            "text": "To add or edit an entry to your \ndomain wide\n filter table, login to your \nmailcow UI\n as (domain) administrator.\n\n\n\n\n\n\nInfo\n\n\nBe aware that a user \nmay override\n this setting by setting his own black- and whitelist!", 
            "title": "Blacklist / Whitelist"
        }, 
        {
            "location": "/spamfilter/", 
            "text": "A mailbox user may adjust the spam filter and black- / whitelist settings for his mailbox individually by navigating to the \nSpam filter\n tab in the users mailcow UI.\n\n\n\n\n\n\nInfo\n\n\nFor global adjustments on your spam filter please check our section on \nRspamd\n.\n\n\nFor a domain wide black- and whitelist please check our guide on \nBlack / Whitelist", 
            "title": "Spamfilter"
        }, 
        {
            "location": "/spamalias/", 
            "text": "These temporary email aliases are mostly used for places where we need to provide an email address but don't want future correspondence with. They are also called spam alias.\n\n\nTo create, delete or extend a temporary email aliase you need to login to mailcow's UI as a mailbox user and navigate to the tab \nTemporary email aliases\n:", 
            "title": "Temporary email aliase"
        }, 
        {
            "location": "/tagging/", 
            "text": "Mailbox users can tag their mail address like in \nme+facebook@example.org\n. They can control the taghandling in the users \nmailcow UI\n panel.\n\n\n\n\nAvailable Actions\n\n\n1. Move this message to a subfolder \"facebook\" (will be created lower case if not existing)\n\n\n2. Prepend the tag to the subject: \"[facebook] Subject\"", 
            "title": "Tagging"
        }, 
        {
            "location": "/tagging/#available-actions", 
            "text": "1. Move this message to a subfolder \"facebook\" (will be created lower case if not existing)  2. Prepend the tag to the subject: \"[facebook] Subject\"", 
            "title": "Available Actions"
        }, 
        {
            "location": "/tfa/", 
            "text": "So far three methods for \nTwo-Factor Authentication\n are implemented: U2F, Yubi OTP, and TOTP\n\n\n\n\nFor U2F to work, you need an encrypted connection to the server (HTTPS) as well as a FIDO security key.\n\n\nBoth U2F and Yubi OTP work well with the fantastic \nYubikey\n.\n\n\nWhile Yubi OTP needs an active internet connection and an API ID + key, U2F will work with any FIDO U2F USB key out of the box, but can only be used when mailcow is accessed over HTTPS.\n\n\nU2F and Yubi OTP support multiple keys per user.\n\n\nAs the third TFA method mailcow uses TOTP: time-based one-time passwords. Those psaswords can be generated with apps like \"Google Authenticator\" after initially scanning a QR code or entering the given secret manually.\n\n\n\n\nAs administrator you are able to temporary disable a domain administrators TFA login until they successfully logged in.\n\n\nThe key used to login will be displayed in green, while other keys remain grey.\n\n\nYubi OTP\n\n\nThe Yubi API ID and Key will be checked against the Yubico Cloud API. When setting up TFA you will be asked for your personal API account for this key.\nThe API ID, API key and the first 12 characters (your YubiKeys ID in modhex) are stored in the MySQL table as secret.\n\n\nU2F\n\n\nOnly Google Chrome (+derivates) and Opera support U2F authentication to this day natively.\nFor Firefox you will need to install the \"U2F Support Add-on\" as provided on \nmozilla.org\n.\n\n\nU2F works without an internet connection.\n\n\nTOTP\n\n\nThe best known TFA method mostly used with a smartphone.", 
            "title": "Two-Factor Authentication"
        }, 
        {
            "location": "/tfa/#yubi-otp", 
            "text": "The Yubi API ID and Key will be checked against the Yubico Cloud API. When setting up TFA you will be asked for your personal API account for this key.\nThe API ID, API key and the first 12 characters (your YubiKeys ID in modhex) are stored in the MySQL table as secret.", 
            "title": "Yubi OTP"
        }, 
        {
            "location": "/tfa/#u2f", 
            "text": "Only Google Chrome (+derivates) and Opera support U2F authentication to this day natively.\nFor Firefox you will need to install the \"U2F Support Add-on\" as provided on  mozilla.org .  U2F works without an internet connection.", 
            "title": "U2F"
        }, 
        {
            "location": "/tfa/#totp", 
            "text": "The best known TFA method mostly used with a smartphone.", 
            "title": "TOTP"
        }, 
        {
            "location": "/redis/", 
            "text": "Redis is used as a key-value store for (some of) mailcow's and rspamd's settings and data. If you are unfamilliar with redis please read the \nintroduction to redis\n and maybe visit this \nwonderfull guide\n on how to use it.\n\n\nClient\n\n\nTo connect to the redis cli execute:\n\n\ndocker-compose exec redis-mailcow redis-cli\n\n\n\n\n\nDebugging\n\n\nHere are some usefull commands for the redis-cli for debugging:\n\n\nMONITOR\n\n\nListens for all requests received by the server in real time:\n\n\n# docker-compose exec redis-mailcow redis-cli\n127.0.0.1:6379\n monitor\nOK\n1494077286.401963 [0 172.22.1.253:41228] \nSMEMBERS\n \nBAYES_SPAM_keys\n\n1494077288.292970 [0 172.22.1.253:41229] \nSMEMBERS\n \nBAYES_SPAM_keys\n\n[...]\n\n\n\n\n\nKEYS\n\n\nGet all keys matching your pattern:\n\n\n\n\n\n\n\n\nPING\n\n\nTest a connection:\n\n\n127.0.0.1:6379\n PING\nPONG\n\n\n\n\n\nIf you want to know more, here is a \ncheat sheet\n.", 
            "title": "Redis"
        }, 
        {
            "location": "/redis/#client", 
            "text": "To connect to the redis cli execute:  docker-compose exec redis-mailcow redis-cli", 
            "title": "Client"
        }, 
        {
            "location": "/redis/#debugging", 
            "text": "Here are some usefull commands for the redis-cli for debugging:", 
            "title": "Debugging"
        }, 
        {
            "location": "/redis/#monitor", 
            "text": "Listens for all requests received by the server in real time:  # docker-compose exec redis-mailcow redis-cli\n127.0.0.1:6379  monitor\nOK\n1494077286.401963 [0 172.22.1.253:41228]  SMEMBERS   BAYES_SPAM_keys \n1494077288.292970 [0 172.22.1.253:41229]  SMEMBERS   BAYES_SPAM_keys \n[...]", 
            "title": "MONITOR"
        }, 
        {
            "location": "/redis/#keys", 
            "text": "Get all keys matching your pattern:", 
            "title": "KEYS"
        }, 
        {
            "location": "/redis/#ping", 
            "text": "Test a connection:  127.0.0.1:6379  PING\nPONG  If you want to know more, here is a  cheat sheet .", 
            "title": "PING"
        }, 
        {
            "location": "/rspamd/", 
            "text": "Rspamd is used for av handling, dkim signing and spam handling. It's a powerfull and fast filter system. For a more in-depth documentation on Rspamd please visit it's \nown documentation\n.\n\n\nLearn Spam \n Ham\n\n\nRspamd learns mail as spam or ham when you move a message in or out of the junk folder to any mailbox besides trash.\nThis is archived by using the Dovecot plugin \"antispam\" and a simple parser script.\n\n\nRspamd also auto-learns mail when a high or low score is detected (see \nhttps://rspamd.com/doc/configuration/statistic.html#autolearning\n)\n\n\nThe bayes statistics are written to Redis as keys \nBAYES_HAM\n and \nBAYES_SPAM\n.\n\n\nYou can also use Rspamd's web ui to learn ham and/or spam.\n\n\nLearn Spam or Ham from existing directory\n\n\nYou can use a one-liner to learn mail in plain-text (uncompressed) format:\n\n\n# Ham\nfor file in /my/folder/cur/*; do docker exec -i $(docker-compose ps -q rspamd-mailcow) rspamc learn_ham \n $file; done\n# Spam\nfor file in /my/folder/.Junk/cur/*; do docker exec -i $(docker-compose ps -q rspamd-mailcow) rspamc learn_spam \n $file; done\n\n\n\n\n\nConsider attaching a local folder as new volume to \nrspamd-mailcow\n in \ndocker-compose.yml\n and learn given files inside the container. This can be used as workaround to parse compressed data with zcat. Example:\n\n\nfor file in /data/old_mail/.Junk/cur/*; do rspamc learn_spam \n zcat $file; done\n\n\n\n\n\nCLI tools\n\n\ndocker-compose exec rspamd-mailcow rspamc --help\ndocker-compose exec rspamd-mailcow rspamadm --help\n\n\n\n\n\nSee \nRspamd documentation", 
            "title": "Rspamd"
        }, 
        {
            "location": "/rspamd/#learn-spam-ham", 
            "text": "Rspamd learns mail as spam or ham when you move a message in or out of the junk folder to any mailbox besides trash.\nThis is archived by using the Dovecot plugin \"antispam\" and a simple parser script.  Rspamd also auto-learns mail when a high or low score is detected (see  https://rspamd.com/doc/configuration/statistic.html#autolearning )  The bayes statistics are written to Redis as keys  BAYES_HAM  and  BAYES_SPAM .  You can also use Rspamd's web ui to learn ham and/or spam.", 
            "title": "Learn Spam &amp; Ham"
        }, 
        {
            "location": "/rspamd/#learn-spam-or-ham-from-existing-directory", 
            "text": "You can use a one-liner to learn mail in plain-text (uncompressed) format:  # Ham\nfor file in /my/folder/cur/*; do docker exec -i $(docker-compose ps -q rspamd-mailcow) rspamc learn_ham   $file; done\n# Spam\nfor file in /my/folder/.Junk/cur/*; do docker exec -i $(docker-compose ps -q rspamd-mailcow) rspamc learn_spam   $file; done  Consider attaching a local folder as new volume to  rspamd-mailcow  in  docker-compose.yml  and learn given files inside the container. This can be used as workaround to parse compressed data with zcat. Example:  for file in /data/old_mail/.Junk/cur/*; do rspamc learn_spam   zcat $file; done", 
            "title": "Learn Spam or Ham from existing directory"
        }, 
        {
            "location": "/rspamd/#cli-tools", 
            "text": "docker-compose exec rspamd-mailcow rspamc --help\ndocker-compose exec rspamd-mailcow rspamadm --help  See  Rspamd documentation", 
            "title": "CLI tools"
        }, 
        {
            "location": "/anonym_headers/", 
            "text": "Save as \ndata/conf/postfix/mailcow_anonymize_headers.pcre\n:\n\n\n/^\\s*Received:[^\\)]+\\)\\s+\\(Authenticated sender:(.+)/\n    REPLACE Received: from localhost (localhost [127.0.0.1]) (Authenticated sender:$1\n/^\\s*User-Agent/        IGNORE\n/^\\s*X-Enigmail/        IGNORE\n/^\\s*X-Mailer/          IGNORE\n/^\\s*X-Originating-IP/  IGNORE\n/^\\s*X-Forward/         IGNORE\n\n\n\n\n\nAdd this to \ndata/conf/postfix/main.cf\n:\n\n\nsmtp_header_checks = pcre:/opt/postfix/conf/mailcow_anonymize_headers.pcre", 
            "title": "Anonymize Headers"
        }, 
        {
            "location": "/disable_sender_verification/", 
            "text": "This option is not best-practice and should only be implemented when there is no other option available to archive whatever you are trying to do.\n\n\nSimply create a file \ndata/conf/postfix/check_sasl_access\n and enter the following content. This user must exist in your installation and needs to authenticate before sending mail.\n\n\nuser-to-allow-everything@example.com OK\n\n\n\n\n\nOpen \ndata/conf/postfix/main.cf\n and find \nsmtpd_sender_restrictions\n. Prepend \ncheck_sasl_access hash:/opt/postfix/conf/check_sasl_access\n like this:\n\n\nsmtpd_sender_restrictions = check_sasl_access hash:/opt/postfix/conf/check_sasl_access reject_authenticated_sender_login_mismatch [...]\n\n\n\n\n\nRun postmap on check_sasl_access:\n\n\ndocker-compose exec postfix-mailcow postmap /opt/postfix/conf/check_sasl_access\n\n\n\n\n\nRestart the Postfix container.", 
            "title": "Disable Sender Addresses Verification"
        }, 
        {
            "location": "/why_bind9/", 
            "text": "For DNS blacklist lookups and DNSSEC.\n\n\nMost systems use either a public or a local caching DNS resolver.\nThat's a very bad idea when it comes to filter spam using DNS-based blackhole lists (DNSBL) or similar technics.\nMost if not all providers apply a rate limit based on the DNS resolver that is used to query their service.\nUsing a public resolver like Googles 4x8, OpenDNS or any other shared DNS resolver like your ISPs will hit that limit very soon.", 
            "title": "Why bind9?"
        }, 
        {
            "location": "/backup_maildir/", 
            "text": "Backup\n\n\nThis line backups the vmail directory to a file backup_vmail.tar.gz in the mailcow root directory:\n\n\ncd /path/to/mailcow-dockerized\nsource mailcow.conf\nDATE=$(date +\n%Y%m%d_%H%M%S\n)\ndocker run --rm -it -v $(docker inspect --format \n{{ range .Mounts }}\\{{ if eq .Destination \n/var/vmail\n }}{{ .Name }}{{ end }}{{ end }}\n $(docker-compose ps -q dovecot-mailcow)):/vmail -v \n${\nPWD\n}\n:/backup debian:jessie tar cvfz /backup/backup_vmail.tar.gz /vmail\n\n\n\n\n\nYou can change the path by adjusting ${PWD} (which equals to the current directory) to any path you have write-access to.\nSet the filename \nbackup_vmail.tar.gz\n to any custom name, but leave the path as it is. Example: \n[...] tar cvfz /backup/my_own_filename_.tar.gz\n\n\nRestore\n\n\ncd /path/to/mailcow-dockerized\nsource mailcow.conf\nDATE=$(date +\n%Y%m%d_%H%M%S\n)\n{% raw %}docker run --rm -it -v $(docker inspect --format \n{{ range .Mounts }}{{ if eq .Destination \n/var/vmail\n }}{{ .Name }}{{ end }}{{ end }}\n $(docker-compose ps -q dovecot-mailcow)):/vmail -v \n${\nPWD\n}\n:/backup debian:jessie tar xvfz /backup/backup_vmail.tar.gz{% endraw %}", 
            "title": "Backup Maildir"
        }, 
        {
            "location": "/backup_maildir/#backup", 
            "text": "This line backups the vmail directory to a file backup_vmail.tar.gz in the mailcow root directory:  cd /path/to/mailcow-dockerized\nsource mailcow.conf\nDATE=$(date + %Y%m%d_%H%M%S )\ndocker run --rm -it -v $(docker inspect --format  {{ range .Mounts }}\\{{ if eq .Destination  /var/vmail  }}{{ .Name }}{{ end }}{{ end }}  $(docker-compose ps -q dovecot-mailcow)):/vmail -v  ${ PWD } :/backup debian:jessie tar cvfz /backup/backup_vmail.tar.gz /vmail  You can change the path by adjusting ${PWD} (which equals to the current directory) to any path you have write-access to.\nSet the filename  backup_vmail.tar.gz  to any custom name, but leave the path as it is. Example:  [...] tar cvfz /backup/my_own_filename_.tar.gz", 
            "title": "Backup"
        }, 
        {
            "location": "/backup_maildir/#restore", 
            "text": "cd /path/to/mailcow-dockerized\nsource mailcow.conf\nDATE=$(date + %Y%m%d_%H%M%S )\n{% raw %}docker run --rm -it -v $(docker inspect --format  {{ range .Mounts }}{{ if eq .Destination  /var/vmail  }}{{ .Name }}{{ end }}{{ end }}  $(docker-compose ps -q dovecot-mailcow)):/vmail -v  ${ PWD } :/backup debian:jessie tar xvfz /backup/backup_vmail.tar.gz{% endraw %}", 
            "title": "Restore"
        }, 
        {
            "location": "/mysql/", 
            "text": "MySQL is used to store the settings and / or usertables of the whole mail-stack (mailcow UI, SOGo, dovecot, postfix).\n\n\nBackup\n\n\ncd /path/to/mailcow-dockerized\nsource mailcow.conf\nDATE=$(date +\n%Y%m%d_%H%M%S\n)\ndocker-compose exec mysql-mailcow mysqldump --default-character-set=utf8mb4 -u\n${\nDBUSER\n}\n -p\n${\nDBPASS\n}\n \n${\nDBNAME\n}\n \n backup_\n${\nDBNAME\n}\n_\n${\nDATE\n}\n.sql\n\n\n\n\n\nRestore\n\n\nYou should redirect the sql dump without Docker-Compose to prevent parsing errors.\n\n\ncd /path/to/mailcow-dockerized\nsource mailcow.conf\ndocker exec -i $(docker-compose ps -q mysql-mailcow) mysql -u\n${\nDBUSER\n}\n -p\n${\nDBPASS\n}\n \n${\nDBNAME\n}\n \n backup\n_file.sql", 
            "title": "MySQL"
        }, 
        {
            "location": "/mysql/#backup", 
            "text": "cd /path/to/mailcow-dockerized\nsource mailcow.conf\nDATE=$(date + %Y%m%d_%H%M%S )\ndocker-compose exec mysql-mailcow mysqldump --default-character-set=utf8mb4 -u ${ DBUSER }  -p ${ DBPASS }   ${ DBNAME }    backup_ ${ DBNAME } _ ${ DATE } .sql", 
            "title": "Backup"
        }, 
        {
            "location": "/mysql/#restore", 
            "text": "You should redirect the sql dump without Docker-Compose to prevent parsing errors.  cd /path/to/mailcow-dockerized\nsource mailcow.conf\ndocker exec -i $(docker-compose ps -q mysql-mailcow) mysql -u ${ DBUSER }  -p ${ DBPASS }   ${ DBNAME }    backup _file.sql", 
            "title": "Restore"
        }, 
        {
            "location": "/autodiscover_config/", 
            "text": "This disables ActiveSync in the autodiscover service for Outlook and configures it with IMAP and SMTP instead:\n\n\nOpen \ndata/web/autodiscover.php\n and set \n'useEASforOutlook' =\n 'yes'\n to \n'useEASforOutlook' =\n 'no'\n.\n\n\nTo always use IMAP and SMTP instead of EAS, set \n'autodiscoverType' =\n 'imap'\n.", 
            "title": "Autodiscover / Autoconfig"
        }, 
        {
            "location": "/80_to_443/", 
            "text": "Since February the 28th 2017 mailcow does come with port 80 and 443 enabled.\n\n\nOpen \nmailcow.conf\n and set \nHTTP_BIND=0.0.0.0\n - if not already set.\n\n\nOpen \ndata/conf/nginx/site.conf\n and add a new site at the top of that file:\n\n\nserver\n \n{\n\n    \nlisten\n \n80\n \ndefault_server\n;\n\n    \ninclude\n \n/etc/nginx/conf.d/server_name.active\n;\n\n    \nreturn\n \n301\n \nhttps\n:\n//\n$\nhost\n$\nrequest_uri\n;\n\n\n}\n\n\n\n\n\n\nIn case you changed the HTTP_BIND parameter, recreate the container:\n\n\ndocker-compose up -d\n\n\n\n\n\nOtherwise restart Nginx:\n\n\ndocker-compose restart nginx-mailcow", 
            "title": "Redirect HTTP to HTTPS"
        }, 
        {
            "location": "/change_config/", 
            "text": "The most important configuration files are mounted from the host into the related containers:\n\n\ndata/conf\n\u251c\u2500\u2500 bind9\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 named.conf\n\u251c\u2500\u2500 dovecot\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 dovecot.conf\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 dovecot-master.passwd\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 sieve_after\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 sql\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 dovecot-dict-sql.conf\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 dovecot-mysql.conf\n\u251c\u2500\u2500 mysql\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 my.cnf\n\u251c\u2500\u2500 nginx\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 dynmaps.conf\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 site.conf\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 templates\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 listen_plain.template\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 listen_ssl.template\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 server_name.template\n\u251c\u2500\u2500 postfix\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 main.cf\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 master.cf\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 postscreen_access.cidr\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 smtp_dsn_filter\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 sql\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 mysql_relay_recipient_maps.cf\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 mysql_tls_enforce_in_policy.cf\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 mysql_tls_enforce_out_policy.cf\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 mysql_virtual_alias_domain_catchall_maps.cf\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 mysql_virtual_alias_domain_maps.cf\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 mysql_virtual_alias_maps.cf\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 mysql_virtual_domains_maps.cf\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 mysql_virtual_mailbox_maps.cf\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 mysql_virtual_relay_domain_maps.cf\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 mysql_virtual_sender_acl.cf\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 mysql_virtual_spamalias_maps.cf\n\u251c\u2500\u2500 rmilter\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 rmilter.conf\n\u251c\u2500\u2500 rspamd\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 dynmaps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 authoritative.php\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 settings.php\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 tags.php\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 vars.inc.php -\n ../../../web/inc/vars.inc.php\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 local.d\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 dkim.conf\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 metrics.conf\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 options.inc\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 redis.conf\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 rspamd.conf.local\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 statistic.conf\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 lua\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 rspamd.local.lua\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 override.d\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 logging.inc\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 worker-controller.inc\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 worker-normal.inc\n\u2514\u2500\u2500 sogo\n    \u251c\u2500\u2500 sieve.creds\n    \u2514\u2500\u2500 sogo.conf\n\n\n\n\n\nJust change the according configuration file on the host and restart the related service:\n\n\ndocker-compose restart service-mailcow", 
            "title": "Adjust Service Configurations"
        }, 
        {
            "location": "/cust_dockerfiles/", 
            "text": "Make your changes in \ndata/Dockerfiles/$service\n and build the image locally:\n\n\ndocker build data/Dockerfiles/service -t mailcow/$service\n\n\n\n\n\nNow auto-recreate modified containers:\n\n\ndocker-compose up -d", 
            "title": "Customize Dockerfiles"
        }, 
        {
            "location": "/dc_bash_compl/", 
            "text": "curl -L https://raw.githubusercontent.com/docker/compose/$(docker-compose version --short)/contrib/completion/bash/docker-compose -o /etc/bash_completion.d/docker-compose", 
            "title": "Docker Compose Bash Completion"
        }, 
        {
            "location": "/deinstall/", 
            "text": "To remove mailcow: dockerized with all it's volumes, images and containers do:\n\n\ndocker-compose down -v --rmi all --remove-orphans\n\n\n\n\n\n\n\nInfo\n\n\n\n\n-v\n Remove named volumes declared in the \nvolumes\n section of the Compose file and anonymous volumes attached to containers.\n\n\n--rmi \n Remove images. Type must be one of: \nall\n: Remove all images used by any service. \nlocal\n: Remove only images that don't have a custom tag set by the \nimage\n field.\n\n\n--remove-orphans\n Remove containsers for services not defined in the compose file.\n\n\nBy default \ndocker-compose down\n only removes currently active containers and networks devinded in the \ndocker-compose.yml\n.", 
            "title": "Deinstall"
        }, 
        {
            "location": "/roundcube/", 
            "text": "Download Roundcube 1.3.x (beta at the time of Feb 2017) to the web htdocs directory and extract it (here \nrc/\n):\n\n\ncd data/web/rc\nwget -O - https://github.com/roundcube/roundcubemail/releases/download/1.3-beta/roundcubemail-1.3-beta-complete.tar.gz | tar xfvz -\n# Change folder name\nmv roundcubemail-1.3* rc\n# Change permissions\nchown -R root: rc/\n\n\n\n\n\nCreate a file \ndata/web/rc/config/config.inc.php\n with the following content.\n\n\nChange the \ndes_key\n parameter to a random value.\n It is used to temporarily store your IMAP password.\n\n\n?php\n\n\nerror_reporting\n(\n0\n);\n\n\nif\n \n(\n!\nfile_exists\n(\n/tmp/mime.types\n))\n \n{\n\n\nfile_put_contents\n(\n/tmp/mime.types\n,\n \nfopen\n(\nhttp://svn.apache.org/repos/asf/httpd/httpd/trunk/docs/conf/mime.types\n,\n \nr\n));\n\n\n}\n\n\n$config\n \n=\n \narray\n();\n\n\n$config\n[\ndb_dsnw\n]\n \n=\n \nmysql://\n \n.\n \ngetenv\n(\nDBUSER\n)\n \n.\n \n:\n \n.\n \ngetenv\n(\nDBPASS\n)\n \n.\n \n@mysql/\n \n.\n \ngetenv\n(\nDBNAME\n);\n\n\n$config\n[\ndefault_host\n]\n \n=\n \ntls://dovecot\n;\n\n\n$config\n[\ndefault_port\n]\n \n=\n \n143\n;\n\n\n$config\n[\nsmtp_server\n]\n \n=\n \ntls://postfix\n;\n\n\n$config\n[\nsmtp_port\n]\n \n=\n \n587\n;\n\n\n$config\n[\nsmtp_user\n]\n \n=\n \n%u\n;\n\n\n$config\n[\nsmtp_pass\n]\n \n=\n \n%p\n;\n\n\n$config\n[\nsupport_url\n]\n \n=\n \n;\n\n\n$config\n[\nproduct_name\n]\n \n=\n \nRoundcube Webmail\n;\n\n\n$config\n[\ndes_key\n]\n \n=\n \nrcmail-!24ByteDESkey*Str\n;\n\n\n$config\n[\nlog_dir\n]\n \n=\n \n/dev/null\n;\n\n\n$config\n[\ntemp_dir\n]\n \n=\n \n/tmp\n;\n\n\n$config\n[\nplugins\n]\n \n=\n \narray\n(\n\n    \narchive\n,\n\n\n);\n\n\n$config\n[\nskin\n]\n \n=\n \nlarry\n;\n\n\n$config\n[\nmime_types\n]\n \n=\n \n/tmp/mime.types\n;\n\n\n$config\n[\nimap_conn_options\n]\n \n=\n \narray\n(\n\n\nssl\n \n=\n \narray\n(\nverify_peer\n \n=\n \nfalse\n,\n \nverify_peer_name\n \n=\n \nfalse\n,\n \nallow_self_signed\n \n=\n \ntrue\n)\n\n\n);\n\n\n$config\n[\nenable_installer\n]\n \n=\n \nfalse\n;\n\n\n$config\n[\nsmtp_conn_options\n]\n \n=\n \narray\n(\n\n\nssl\n \n=\n \narray\n(\nverify_peer\n \n=\n \nfalse\n,\n \nverify_peer_name\n \n=\n \nfalse\n,\n \nallow_self_signed\n \n=\n \ntrue\n)\n\n\n);\n\n\n\n\n\n\nPoint your browser to \nhttps://myserver/rc/installer\n and follow the instructions.\nInitialize the database and leave the installer.\n\n\nDelete the directory \ndata/web/rc/installer\n after a successful installation!\n\n\nEnable change password function in Roundcube\n\n\nOpen \ndata/web/rc/config/config.inc.php\n and enable the password plugin:\n\n\n...\n$config[\nplugins\n] = array(\n    \narchive\n,\n    \npassword\n,\n);\n...\n\n\n\n\n\nOpen \ndata/web/rc/plugins/password/password.php\n, search for \ncase 'ssha':\n and add above:\n\n\n        \ncase\n \nssha256\n:\n\n            \n$\nsalt\n \n=\n \nrcube_utils\n::\nrandom_bytes\n(\n8\n);\n\n            \n$\ncrypted\n \n=\n \nbase64_encode\n(\n \nhash\n(\nsha256\n,\n \n$\npassword\n \n.\n \n$\nsalt\n,\n \nTRUE\n \n)\n \n.\n \n$\nsalt\n \n);\n\n            \n$\nprefix\n  \n=\n \n{SSHA256}\n;\n\n            \nbreak\n;\n\n\n\n\n\n\nOpen \ndata/web/rc/plugins/password/config.inc.php\n and change the following parameters (or add them at the bottom of that file):\n\n\n$config[\npassword_driver\n] = \nsql\n;\n$config[\npassword_algorithm\n] = \nssha256\n;\n$config[\npassword_algorithm_prefix\n] = \n{SSHA256}\n;\n$config[\npassword_query\n] = \nUPDATE mailbox SET password = %P WHERE username = %u\n;", 
            "title": "Roundcube"
        }, 
        {
            "location": "/roundcube/#enable-change-password-function-in-roundcube", 
            "text": "Open  data/web/rc/config/config.inc.php  and enable the password plugin:  ...\n$config[ plugins ] = array(\n     archive ,\n     password ,\n);\n...  Open  data/web/rc/plugins/password/password.php , search for  case 'ssha':  and add above:           case   ssha256 : \n             $ salt   =   rcube_utils :: random_bytes ( 8 ); \n             $ crypted   =   base64_encode (   hash ( sha256 ,   $ password   .   $ salt ,   TRUE   )   .   $ salt   ); \n             $ prefix    =   {SSHA256} ; \n             break ;   Open  data/web/rc/plugins/password/config.inc.php  and change the following parameters (or add them at the bottom of that file):  $config[ password_driver ] =  sql ;\n$config[ password_algorithm ] =  ssha256 ;\n$config[ password_algorithm_prefix ] =  {SSHA256} ;\n$config[ password_query ] =  UPDATE mailbox SET password = %P WHERE username = %u ;", 
            "title": "Enable change password function in Roundcube"
        }, 
        {
            "location": "/portainer/", 
            "text": "In order to enable Portainer, the docker-compose.yml and site.conf for nginx must be modified.\n\n\n1. docker-compose.yml: Insert this block for portainer\n\n\n    portainer-mailcow:\n      image: portainer/portainer\n      volumes:\n        - /var/run/docker.sock:/var/run/docker.sock\n        - ./data/conf/portainer:/data\n      restart: always\n      dns:\n        - 172.22.1.254\n      dns_search: mailcow-network\n      networks:\n        mailcow-network:\n          aliases:\n            - portainer\n\n\n\n\n\n2a. data/conf/nginx/site.conf: Just beneath the opening line, at the same level as a server { block, add this:\n\n\nupstream\n \nportainer\n \n{\n\n  \nserver\n \nportainer-mailcow\n:\n9000\n;\n\n\n}\n\n\n\nmap\n \n$\nhttp_upgrade\n \n$\nconnection_upgrade\n \n{\n\n  \ndefault\n \nupgrade\n;\n\n  \n \nclose\n;\n\n\n}\n\n\n\n\n\n\n2b. data/conf/nginx/site.conf: Then, inside \nboth\n (ssl and plain) server blocks, add this:\n\n\n  \nlocation\n \n/\nportainer\n/\n \n{\n\n    \nproxy_http_version\n \n1.1\n;\n\n    \nproxy_set_header\n \nHost\n              \n$http_host\n;\n   \n#\n \nrequired\n \nfor\n \ndocker\n \nclient\ns\n \nsake\n\n    \nproxy_set_header\n \nX-Real-IP\n         \n$remote_addr\n;\n \n#\n \npass\n \non\n \nreal\n \nclient\ns\n \nIP\n\n    \nproxy_set_header\n \nX-Forwarded-For\n   \n$proxy_add_x_forwarded_for\n;\n\n    \nproxy_set_header\n \nX-Forwarded-Proto\n \n$scheme\n;\n\n    \nproxy_read_timeout\n                 \n900\n;\n\n\n    \nproxy_set_header\n \nConnection\n \n;\n\n    \nproxy_buffers\n \n32\n \n4k\n;\n\n    \nproxy_pass\n \nhttp\n:\n//\nportainer\n/\n;\n\n  \n}\n\n\n  \nlocation\n \n/\nportainer\n/\napi\n/\nwebsocket\n/\n \n{\n\n    \nproxy_http_version\n \n1.1\n;\n\n    \nproxy_set_header\n \nUpgrade\n \n$http_upgrade\n;\n\n    \nproxy_set_header\n \nConnection\n \n$connection_upgrade\n;\n\n    \nproxy_pass\n \nhttp\n:\n//\nportainer\n/\napi\n/\nwebsocket\n/\n;\n\n  \n}\n\n\n\n\n\n\nNow you can simply navigate to https://${MAILCOW_HOSTNAME}/portainer/ to view your Portainer container monitoring page. You\u2019ll then be prompted to specify a new password for the \nadmin\n account. After specifying your password, you\u2019ll then be able to connect to the Portainer UI.", 
            "title": "Portainer"
        }, 
        {
            "location": "/gogs/", 
            "text": "With Gogs' ability to authenticate over SMTP it is trivial to integrate it with mailcow. Few changes are needed:\n\n\n1. Open \ndocker-compose.yml\n and add gogs:\n\n\n    \ngogs\n-\nmailcow\n:\n\n      \nimage\n:\n \ngogs\n/\ngogs\n\n      \nvolumes\n:\n\n        \n-\n \n.\n/\ndata\n/\ngogs\n:\n/\ndata\n\n      \nnetworks\n:\n\n        \nmailcow\n-\nnetwork\n:\n\n          \nipv4_address:\n \n172.22.1.123\n\n          \naliases\n:\n\n            \n-\n \ngogs\n\n      \nports\n:\n\n        \n-\n \n${GOGS_SSH_PORT:-50022}:22\n\n        \n-\n \n${GOGS_WWW_PORT:-50080}:3000\n\n      \ndns\n:\n\n        \n-\n \n172.22.1.254\n\n\n\n\n\n\n2. Open \ndata/conf/nginx/site.conf\n and add in each \nserver{}\n block\n\n\nlocation\n \n/\ngogs\n/\n \n{\n\n    \nproxy_pass\n \nhttp\n:\n//\n172.22.1.123\n:\n3000\n/\n;\n\n\n}\n\n\n\n\n\n\n3. Open \nmailcow.conf\n and define ports you want gogs to open, as well as future database password. Example:\n\n\nGOGS_WWW_PORT=3000\nGOGS_SSH_PORT=4000\nDBGOGS=CorrectHorseBatteryStaple\n\n\n\n\n\n4. Create database and user for Gogs to use.\n\n\n. ./mailcow.conf\ndocker-compose exec mysql-mailcow mysql -uroot -p$DBROOT\nmysql\n CREATE USER gogs IDENTIFIED BY \nCorrectHorseBatteryStaple\n;\nmysql\n CREATE DATABASE gogs;\nmysql\n GRANT ALL PRIVILEGES ON gogs.* to gogs;\n\n\n\n\n\n5. Run \ndocker-compose up -d\n to bring up Gogs container. Verify with \ncurl http://172.22.1.123:3000/\n that it is running.\n\n\n6. Proceed to installer from browser, for the time being using direct url \nhttp://${MAILCOW_HOSTNAME}:${GOGS_WWW_PORT}/\n, for example \nhttp://example.org:3000/\n. For database details set \n172.22.1.2\n as database host, user \ngogs\n, database name \ngogs\n and password as set above\n\n\n7. Once install is complete, login as admin and in settings - authorization enable SMTP. SMTP Host should be \n172.22.1.8\n with port \n587\n. You'll probably want to set \nSkip TLS Verify\n.\n\n\n8. Edit \ndata/gogs/gogs/conf/app.ini\n and set following values. You can consult \nGogs cheat sheet\n for their meaning and other possible values.\n\n\n[server]\n\n\nSSH_LISTEN_PORT\n \n=\n \n22\n\n\nSSH_DOMAIN\n \n=\n \n[domain where ssh is available - used for ssh clone url]\n\n\nSSH_PORT\n \n=\n \n[port where ssh is open on host - used for ssh clone url]\n\n\nROOT_URL\n \n=\n \nhttps://[url]/gogs/\n\n\n\n\n\n\n9. Restart Gogs with \ndocker-compose restart gogs-mailcow\n. Your users should be able to login with mailcow managed accounts.", 
            "title": "Gogs"
        }
    ]
}